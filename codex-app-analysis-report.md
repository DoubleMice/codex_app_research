# Codex App å®Œæ•´åˆ†ææŠ¥å‘Š

> åŸºäº Codex Desktop App çš„äº§å“ç ”ç©¶ä¸é€†å‘å·¥ç¨‹åˆ†æ

---

## ç›®å½•

### ç¬¬ä¸€éƒ¨åˆ†ï¼šäº§å“ç ”ç©¶

- [A. äº§å“æ¦‚è¿°](#a-äº§å“æ¦‚è¿°)
- [B. å¤šä»£ç†å·¥ä½œæµ](#b-å¤šä»£ç†å·¥ä½œæµ)
- [C. Skills ç³»ç»Ÿ](#c-skills-ç³»ç»Ÿ)
- [D. å¼€å‘ç¯å¢ƒé›†æˆ](#d-å¼€å‘ç¯å¢ƒé›†æˆ)
- [E. ä»»åŠ¡è°ƒåº¦](#e-ä»»åŠ¡è°ƒåº¦)
- [F. ç«å“å¯¹æ¯” - Claude Code](#f-ç«å“å¯¹æ¯”---claude-code)
- [G. ç«å“å¯¹æ¯” - GitHub Copilot](#g-ç«å“å¯¹æ¯”---github-copilot)
- [H. ç«å“å¯¹æ¯” - Cursor](#h-ç«å“å¯¹æ¯”---cursor)
- [I. åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ](#i-åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ)
- [J. Electron æ¶æ„](#j-electron-æ¶æ„)
- [K. CLI äºŒè¿›åˆ¶åˆ†æ](#k-cli-äºŒè¿›åˆ¶åˆ†æ)
- [L. JavaScript åˆ†æ](#l-javascript-åˆ†æ)
- [M. æ•°æ®å­˜å‚¨](#m-æ•°æ®å­˜å‚¨)
- [N. ç½‘ç»œé€šä¿¡](#n-ç½‘ç»œé€šä¿¡)
- [O. ç ”ç©¶æ€»ç»“](#o-ç ”ç©¶æ€»ç»“)

### ç¬¬äºŒéƒ¨åˆ†ï¼šæ·±åº¦ä»£ç åˆ†æ

1. [Thread ç®¡ç†å™¨](#1-thread-ç®¡ç†å™¨)
2. [Automation è°ƒåº¦å™¨](#2-automation-è°ƒåº¦å™¨)
3. [Skills åŠ è½½å™¨](#3-skills-åŠ è½½å™¨)
4. [IPC æ¶ˆæ¯è·¯ç”±](#4-ipc-æ¶ˆæ¯è·¯ç”±)
5. [SQLite æ•°æ®è®¿é—®å±‚](#5-sqlite-æ•°æ®è®¿é—®å±‚)
6. [WebSocket å®¢æˆ·ç«¯](#6-websocket-å®¢æˆ·ç«¯)
7. [CLI Rust æ¨¡å—](#7-cli-rust-æ¨¡å—)
8. [MCP åè®®](#8-mcp-åè®®)
9. [OAuth è®¤è¯æµç¨‹](#9-oauth-è®¤è¯æµç¨‹)
10. [Sentry ç›‘æ§é›†æˆ](#10-sentry-ç›‘æ§é›†æˆ)
11. [Sparkle è‡ªåŠ¨æ›´æ–°](#11-sparkle-è‡ªåŠ¨æ›´æ–°)
12. [node-pty ç»ˆç«¯æ¨¡æ‹Ÿ](#12-node-pty-ç»ˆç«¯æ¨¡æ‹Ÿ)
13. [Worker çº¿ç¨‹ä»»åŠ¡å¤„ç†](#13-worker-çº¿ç¨‹ä»»åŠ¡å¤„ç†)
14. [Cloud Tasks äº‘ç«¯ä»»åŠ¡](#14-cloud-tasks-äº‘ç«¯ä»»åŠ¡)
15. [æ¶æ„æ€»ç»“](#15-æ¶æ„æ€»ç»“)
16. [æ¶æ„æ·±åº¦åˆ†æ](#16-æ¶æ„æ·±åº¦åˆ†æ)
17. [å®‰å…¨æœºåˆ¶æ·±åº¦åˆ†æ](#17-å®‰å…¨æœºåˆ¶æ·±åº¦åˆ†æ)
18. [App Server Protocol åè®®åˆ†æ](#18-app-server-protocol-åè®®åˆ†æ)
19. [å·¥å…·ç³»ç»Ÿåˆ†æ](#19-å·¥å…·ç³»ç»Ÿåˆ†æ)
20. [é…ç½®ç³»ç»Ÿåˆ†æ](#20-é…ç½®ç³»ç»Ÿåˆ†æ)
21. [Prompt å·¥ç¨‹åˆ†æ](#21-prompt-å·¥ç¨‹åˆ†æ)
22. [é”™è¯¯å¤„ç†æœºåˆ¶åˆ†æ](#22-é”™è¯¯å¤„ç†æœºåˆ¶åˆ†æ)
23. [çŠ¶æ€æœºåˆ†æ](#23-çŠ¶æ€æœºåˆ†æ)
24. [æ•°æ®æµåˆ†æ](#24-æ•°æ®æµåˆ†æ)
25. [é€†å‘åˆ†ææ€»ç»“æŠ¥å‘Š](#25-é€†å‘åˆ†ææ€»ç»“æŠ¥å‘Š)

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ·±åº¦é€†å‘åˆ†æè¯¦æƒ…

26. [main-BLcwFbOH.js é€†å‘åˆ†æ](#26-main-blcwfbohjs-é€†å‘åˆ†æ)
27. [worker-C_GFIvBQ.js é€†å‘åˆ†æ](#27-worker-c_gfivbqjs-é€†å‘åˆ†æ)
28. [preload.js é€†å‘åˆ†æ](#28-preloadjs-é€†å‘åˆ†æ)
29. [codex CLI äºŒè¿›åˆ¶é€†å‘åˆ†æ](#29-codex-cli-äºŒè¿›åˆ¶é€†å‘åˆ†æ)
30. [sparkle.node åŸç”Ÿæ¨¡å—é€†å‘](#30-sparklenode-åŸç”Ÿæ¨¡å—é€†å‘)
31. [pty.node ç»ˆç«¯åŸç”Ÿæ¨¡å—é€†å‘](#31-ptynode-ç»ˆç«¯åŸç”Ÿæ¨¡å—é€†å‘)
32. [better_sqlite3.node æ•°æ®åº“æ¨¡å—é€†å‘](#32-better_sqlite3node-æ•°æ®åº“æ¨¡å—é€†å‘)
33. [JS ä»£ç æ··æ·†åˆ†æ](#33-js-ä»£ç æ··æ·†åˆ†æ)
34. [App Server åè®®æ¶ˆæ¯æ ¼å¼é€†å‘](#34-app-server-åè®®æ¶ˆæ¯æ ¼å¼é€†å‘)
35. [Seatbelt æ²™ç®±ç­–ç•¥é€†å‘](#35-seatbelt-æ²™ç®±ç­–ç•¥é€†å‘)
36. [package.json ä¾èµ–åˆ†æ](#36-packagejson-ä¾èµ–åˆ†æ)
37. [æ¸²æŸ“è¿›ç¨‹å…¥å£åˆ†æ](#37-æ¸²æŸ“è¿›ç¨‹å…¥å£åˆ†æ)
38. [ç¡¬ç¼–ç  URL åˆ†æ](#38-ç¡¬ç¼–ç -url-åˆ†æ)
39. [Electron çª—å£é…ç½®](#39-electron-çª—å£é…ç½®)
40. [node-pty æºç åˆ†æ](#40-node-pty-æºç åˆ†æ)
41. [ç¯å¢ƒå˜é‡æ±‡æ€»](#41-ç¯å¢ƒå˜é‡æ±‡æ€»)
42. [Appcast XML æ›´æ–°æºåˆ†æ](#42-appcast-xml-æ›´æ–°æºåˆ†æ)
43. [CLI å¸®åŠ©æ–‡æ¡£åˆ†æ](#43-cli-å¸®åŠ©æ–‡æ¡£åˆ†æ)
44. [æ€»ç»“ä¸å¯ç¤º](#44-æ€»ç»“ä¸å¯ç¤º)

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šäº§å“ç ”ç©¶

---

## A. äº§å“æ¦‚è¿°

### åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | ä¿¡æ¯ |
|------|------|
| äº§å“åç§° | OpenAI Codex App |
| å¼€å‘å•† | OpenAI |
| Bundle ID | com.openai.codex |
| å½“å‰ç‰ˆæœ¬ | 260208.1016 (Build 571) |
| æŠ€æœ¯æ ˆ | Electron 40.0.0 |

### å‘å¸ƒæ—¶é—´çº¿

- **2021å¹´**: OpenAI Codex API é¦–æ¬¡å‘å¸ƒï¼Œä¸º GitHub Copilot æä¾›æ”¯æŒ
- **2023å¹´3æœˆ23æ—¥**: åŸå§‹ Codex API åœæ­¢æœåŠ¡ï¼Œå¼€å‘è€…è½¬å‘ GPT-3.5-Turbo
- **2025å¹´4æœˆ**: Codex App for macOS é¦–æ¬¡å‘å¸ƒ
- **2025å¹´12æœˆ**: GPT-5.2-Codex æ¨¡å‹å‘å¸ƒ
- **2026å¹´2æœˆ2æ—¥**: Codex App æ¡Œé¢ç‰ˆæ­£å¼å‘å¸ƒ

### æ”¯æŒå¹³å°

| å¹³å° | çŠ¶æ€ |
|------|------|
| macOS (Apple Silicon: M1/M2/M3+) | âœ… å·²æ”¯æŒ |
| macOS æœ€ä½ç‰ˆæœ¬ | 12.0 |
| Windows | ğŸ”„ å¼€å‘ä¸­ |
| Linux | ğŸ”„ è®¡åˆ’ä¸­ |

### è®¢é˜…è®¡åˆ’

| è®¡åˆ’ | è®¿é—®æƒé™ |
|------|----------|
| ChatGPT Plus | âœ… åŒ…å« |
| ChatGPT Pro | âœ… åŒ…å« |
| ChatGPT Business | âœ… åŒ…å« |
| ChatGPT Enterprise | âœ… åŒ…å« |
| ChatGPT Edu | âœ… åŒ…å« |
| ChatGPT Free/Go | â³ é™æ—¶å¼€æ”¾ |

### AI æ¨¡å‹ - GPT-5.2-Codex

| ç‰¹æ€§ | è§„æ ¼ |
|------|------|
| ä¸Šä¸‹æ–‡çª—å£ | 400,000 tokens |
| å¤šæ¨¡æ€èƒ½åŠ› | æ”¯æŒ UI è®¾è®¡ã€å›¾è¡¨ã€æˆªå›¾ç†è§£ |
| å‘å¸ƒæ—¶é—´ | 2025å¹´12æœˆ |

### æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ

1. **å¤šä»£ç†ç¼–æ’** - åŒæ—¶è¿è¡Œå¤šä¸ª AI ä»£ç†ï¼Œæ¯ä¸ªä»£ç†åœ¨ç‹¬ç«‹çš„ Git worktree ä¸­å·¥ä½œ
2. **ç«¯åˆ°ç«¯ä»»åŠ¡å¤„ç†** - ç¼–å†™åŠŸèƒ½ä»£ç ã€ä¿®å¤ Bugã€å›ç­”ä»£ç åº“é—®é¢˜ã€æå‡º Pull Request
3. **è‡ªåŠ¨åŒ–ä»»åŠ¡** - åå°å®šæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œç»“åˆ Skills æ‰§è¡Œå¤æ‚å·¥ä½œæµ
4. **Git é›†æˆ** - å†…ç½® diff æŸ¥çœ‹ã€è¡Œå†…è¯„è®ºã€æš‚å­˜/æ’¤é”€æ›´æ”¹ã€ç›´æ¥æäº¤

---

## B. å¤šä»£ç†å·¥ä½œæµ

### æ ¸å¿ƒæ¦‚å¿µ

**Threadï¼ˆçº¿ç¨‹ï¼‰**
- æ¯ä¸ªä»»åŠ¡è¿è¡Œåœ¨ç‹¬ç«‹çš„ Thread ä¸­
- Thread æœ‰å”¯ä¸€çš„ `thread_id`
- æ”¯æŒ Thread æ ‡é¢˜å’ŒçŠ¶æ€ç®¡ç†
- å¯ä»¥å›ºå®šï¼ˆpinï¼‰é‡è¦çš„ Thread

**Automationï¼ˆè‡ªåŠ¨åŒ–ï¼‰**
- å®šæ—¶æ‰§è¡Œçš„åå°ä»»åŠ¡
- æ¯æ¬¡è¿è¡Œåˆ›å»ºä¸€ä¸ª `automation_run` è®°å½•
- æ”¯æŒ RRule æ ¼å¼çš„é‡å¤è§„åˆ™

### æ•°æ®åº“ Schema

```sql
-- automations è¡¨
CREATE TABLE automations (
  id TEXT PRIMARY KEY,
  prompt TEXT NOT NULL,
  status TEXT NOT NULL DEFAULT 'ACTIVE',
  last_run_at INTEGER,
  next_run_at INTEGER,
  cwds TEXT NOT NULL DEFAULT '[]',
  rrule TEXT,
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL
)

-- automation_runs è¡¨
CREATE TABLE automation_runs (
  thread_id TEXT PRIMARY KEY,
  automation_id TEXT NOT NULL,
  status TEXT NOT NULL,
  read_at INTEGER,
  thread_title TEXT,
  source_cwd TEXT,
  inbox_title TEXT,
  inbox_summary TEXT,
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL
)
```

### ä»»åŠ¡çŠ¶æ€æµè½¬

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| IN_PROGRESS | ä»»åŠ¡æ‰§è¡Œä¸­ |
| PENDING_REVIEW | ç­‰å¾…ç”¨æˆ·å®¡æ ¸ |
| READ | ç”¨æˆ·å·²æŸ¥çœ‹ |
| ARCHIVED | å·²å½’æ¡£ |

---

## C. Skills ç³»ç»Ÿ

### Skills å­˜å‚¨ä½ç½®

| ä½ç½® | è¯´æ˜ |
|------|------|
| `~/.codex/skills/` | ç”¨æˆ·è‡ªå®šä¹‰ Skills |
| `skills/.curated` | å®˜æ–¹ç²¾é€‰ Skills |
| `skills/.experimental` | å®éªŒæ€§ Skills |
| `vendor_imports/skills` | ç¬¬ä¸‰æ–¹å¯¼å…¥ Skills |

### å®˜æ–¹ Skills ä»“åº“

- **ä»“åº“åœ°å€**: https://github.com/openai/skills.git

### Skill å®šä¹‰æ ¼å¼

```
skill-name/
â”œâ”€â”€ SKILL.md          # Skill è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ agents/
â”‚   â””â”€â”€ openai.yaml   # OpenAI ä»£ç†é…ç½®
â””â”€â”€ assets/
    â”œâ”€â”€ icon-small.*  # å°å›¾æ ‡
    â””â”€â”€ icon-large.*  # å¤§å›¾æ ‡
```

### openai.yaml é…ç½®

```yaml
interface:
  short_description: "æŠ€èƒ½ç®€çŸ­æè¿°"
  icon_small: "icon-small.png"
  icon_large: "icon-large.png"
```

---

## D. å¼€å‘ç¯å¢ƒé›†æˆ

### CLI å·¥å…·

| é¡¹ç›® | å€¼ |
|------|-----|
| ä½ç½® | `Codex.app/Contents/Resources/codex` |
| æ¶æ„ | ARM64 Mach-O |
| å¤§å° | ~54MB |

### ç»ˆç«¯é›†æˆ

- å¿«æ·é”®: `Cmd+J` åˆ‡æ¢ç»ˆç«¯
- ä½¿ç”¨ `node-pty` å®ç°ç»ˆç«¯æ¨¡æ‹Ÿ
- æ”¯æŒè¿œç¨‹ä¸»æœº SSH è¿æ¥

### æ”¯æŒçš„åº”ç”¨

| ç±»åˆ« | åº”ç”¨ |
|------|------|
| IDE | VS Code, VS Code Insiders, Cursor, Windsurf |
| JetBrains | IntelliJ, PyCharm, GoLand, WebStorm, RustRover, Android Studio |
| ç¼–è¾‘å™¨ | Xcode, Zed, TextMate, BBEdit |
| ç»ˆç«¯ | Terminal, iTerm2, Warp, Ghostty |

### URL Scheme

- **åè®®**: `codex://`

---

## E. ä»»åŠ¡è°ƒåº¦

### RRule è°ƒåº¦ç³»ç»Ÿ

```javascript
{
  rrule: "FREQ=DAILY;INTERVAL=1",
  next_run_at: 1707580800000,
  last_run_at: 1707494400000
}
```

### RRule æ ¼å¼ç¤ºä¾‹

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| `FREQ=DAILY` | æ¯å¤©æ‰§è¡Œ |
| `FREQ=WEEKLY;BYDAY=MO,WE,FR` | æ¯å‘¨ä¸€ä¸‰äº” |
| `FREQ=HOURLY;INTERVAL=2` | æ¯2å°æ—¶ |

---

## F. ç«å“å¯¹æ¯” - Claude Code

| é¡¹ç›® | Codex App | Claude Code |
|------|-----------|-------------|
| å¼€å‘å•† | OpenAI | Anthropic |
| ç±»å‹ | æ¡Œé¢åº”ç”¨ | CLI å·¥å…· |
| å¹³å° | macOS | macOS, Linux, Windows |
| å¤šä»£ç† | Thread å¹¶è¡Œ | Subagent ç³»ç»Ÿ |
| è‡ªåŠ¨åŒ– | Automation + RRule | Hooks ç³»ç»Ÿ |
| æ‰©å±•æ€§ | Skills | MCP + è‡ªå®šä¹‰å‘½ä»¤ |

---

## G. ç«å“å¯¹æ¯” - GitHub Copilot

| é¡¹ç›® | Codex App | GitHub Copilot |
|------|-----------|----------------|
| å¼€å‘å•† | OpenAI | GitHub/Microsoft |
| ç±»å‹ | æ¡Œé¢åº”ç”¨ | IDE æ’ä»¶ + Agent |
| å®æ—¶è¡¥å…¨ | æœ‰é™ | æ ¸å¿ƒåŠŸèƒ½ |
| å¤šæ–‡ä»¶ç¼–è¾‘ | æ”¯æŒ | Agent Mode æ”¯æŒ |
| ä¸Šä¸‹æ–‡ç†è§£ | 400K tokens | Copilot Memory |

---

## H. ç«å“å¯¹æ¯” - Cursor

| é¡¹ç›® | Codex App | Cursor |
|------|-----------|--------|
| å¼€å‘å•† | OpenAI | Anysphere |
| ç±»å‹ | æ¡Œé¢åº”ç”¨ | AI IDE |
| åŸºç¡€ | Electron | VS Code Fork |
| ä»£ç è¡¥å…¨ | æœ‰é™ | Cursor Tab |
| ä»£ç ç´¢å¼• | éƒ¨åˆ† | å…¨é¡¹ç›®ç´¢å¼• |

---

## I. åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ

| åŠŸèƒ½ | Codex App | Claude Code | GitHub Copilot | Cursor |
|------|-----------|-------------|----------------|--------|
| ä»£ç è¡¥å…¨ | âšª | âšª | âœ… | âœ… |
| å¤šæ–‡ä»¶ç¼–è¾‘ | âœ… | âœ… | âœ… | âœ… |
| è‡ªä¸»æ‰§è¡Œ | âœ… | âœ… | âœ… | âœ… |
| å®šæ—¶ä»»åŠ¡ | âœ… | âšª | âšª | âšª |
| è‡ªå®šä¹‰æŠ€èƒ½ | Skills | MCP | Custom Agents | - |
| å¤šæ¨¡å‹ | âšª | âœ… | âœ… | âœ… |

---

## J. Electron æ¶æ„

### åº”ç”¨ç»“æ„

```
Codex.app/Contents/
â”œâ”€â”€ MacOS/Codex          # ä¸»å…¥å£
â”œâ”€â”€ Frameworks/          # æ¡†æ¶ä¾èµ–
â”œâ”€â”€ Resources/
â”‚   â”œâ”€â”€ app.asar         # åº”ç”¨ä»£ç åŒ…
â”‚   â””â”€â”€ codex            # CLI äºŒè¿›åˆ¶
â””â”€â”€ Info.plist           # åº”ç”¨é…ç½®
```

### è¿›ç¨‹æ¨¡å‹

| è¿›ç¨‹ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| Main | main-BLcwFbOH.js | ä¸»è¿›ç¨‹ (~2.5MB) |
| Renderer | webview/ | æ¸²æŸ“è¿›ç¨‹ (React 18) |
| Worker | worker-C_GFIvBQ.js | Worker çº¿ç¨‹ (~726KB) |
| Preload | preload.js | æ¡¥æ¥è„šæœ¬ (~2KB) |

### electronBridge API

```javascript
window.electronBridge = {
  windowType: "electron",
  sendMessageFromView: async (msg) => {},
  getPathForFile: (file) => {},
  sendWorkerMessageFromView: async (workerId, msg) => {},
  subscribeToWorkerMessages: (workerId, callback) => {},
  showContextMenu: async (options) => {},
  triggerSentryTestError: async () => {},
  getSentryInitOptions: () => {},
  getAppSessionId: () => {},
  getBuildFlavor: () =>
}
```

### åŸç”Ÿæ¨¡å—

| æ¨¡å— | ç”¨é€” |
|------|------|
| better-sqlite3 | SQLite æ•°æ®åº“ |
| node-pty | ç»ˆç«¯æ¨¡æ‹Ÿ |
| electron-liquid-glass | macOS æ¯›ç»ç’ƒæ•ˆæœ |
| sparkle | è‡ªåŠ¨æ›´æ–° (Sparkle) |

---

## K. CLI äºŒè¿›åˆ¶åˆ†æ

### åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| æ–‡ä»¶å | codex |
| ç±»å‹ | Mach-O 64-bit executable arm64 |
| å¤§å° | ~54MB |
| å¼€å‘è¯­è¨€ | Rust |

### é“¾æ¥åº“

- AppKit.framework
- CoreGraphics.framework
- CoreFoundation.framework
- Security.framework
- liblzma.5.dylib
- libbz2.1.0.dylib

### Rust æ¨¡å—ç»“æ„

```
codex_core::auth    - è®¤è¯æ¨¡å—
codex_core::exec    - æ‰§è¡Œæ¨¡å—
codex_core::util    - å·¥å…·æ¨¡å—
codex_mcp_server    - MCP æœåŠ¡å™¨
codex_mcp_client    - MCP å®¢æˆ·ç«¯
```

### æ”¯æŒçš„æ¨¡å‹

| æ¨¡å‹ | è¯´æ˜ |
|------|------|
| gpt-5-codex-mini | è½»é‡ç‰ˆæ¨¡å‹ |
| gpt-oss:20b | å¼€æºæ¨¡å‹ |

### è®¤è¯æ–¹å¼

1. **ChatGPT ç™»å½•** - OAuth è®¤è¯
2. **API Key ç™»å½•** - ç›´æ¥ä½¿ç”¨ API å¯†é’¥
3. **Account ç™»å½•** - è´¦æˆ·è®¤è¯

### Cloud Tasks åŠŸèƒ½

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| codex_cloud_tasks_diff | æŸ¥çœ‹å·®å¼‚ |
| codex_cloud_tasks_exec | æ‰§è¡Œä»»åŠ¡ |
| codex_cloud_tasks_list | åˆ—å‡ºä»»åŠ¡ |
| codex_cloud_tasks_apply | åº”ç”¨æ›´æ”¹ |
| codex_cloud_tasks_tui | TUI ç•Œé¢ |

---

## L. JavaScript åˆ†æ

### æ–‡ä»¶ç»“æ„

| æ–‡ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| main-BLcwFbOH.js | ~2.5MB | ä¸»è¿›ç¨‹ä»£ç  |
| worker-C_GFIvBQ.js | ~726KB | Worker ä»£ç  |
| preload.js | ~2KB | Preload è„šæœ¬ |

### IPC é€šä¿¡

| é€šé“ | ç±»å‹ | åŠŸèƒ½ |
|------|------|------|
| `codex_desktop:check-for-updates` | handle | æ£€æŸ¥æ›´æ–° |
| `codex_desktop:show-context-menu` | handle | æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå• |
| `codex_desktop:get-sentry-init-options` | sync | è·å– Sentry é…ç½® |

### ä»£ç æ··æ·†ç‰¹å¾

- å˜é‡åç¼©çŸ­ (å¦‚ L, n, r, t)
- ç±»åæ··æ·† (å¦‚ Ii, Bl, HU)
- æä¾› `.map` Source Maps æ–‡ä»¶

---

## M. æ•°æ®å­˜å‚¨

### æ•°æ®åº“ä½ç½®

```
$CODEX_HOME/sqlite/
```

### æ•°æ®è¡¨ç»“æ„

**inbox_items è¡¨**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | TEXT | ä¸»é”® |
| title | TEXT | æ ‡é¢˜ |
| thread_id | TEXT | çº¿ç¨‹ ID |
| read_at | INTEGER | é˜…è¯»æ—¶é—´ |
| created_at | INTEGER | åˆ›å»ºæ—¶é—´ |

**automations è¡¨**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | TEXT | ä¸»é”® |
| prompt | TEXT | æç¤ºè¯ |
| status | TEXT | çŠ¶æ€ |
| rrule | TEXT | è°ƒåº¦è§„åˆ™ |
| next_run_at | INTEGER | ä¸‹æ¬¡è¿è¡Œæ—¶é—´ |

### æ–‡ä»¶å­˜å‚¨

| è·¯å¾„ | æ ¼å¼ | å†…å®¹ |
|------|------|------|
| `$CODEX_HOME/automations/<id>/` | TOML | Automation é…ç½® |
| `~/.codex/skills/` | YAML | Skills é…ç½® |
| `$CODEX_HOME/threads/` | - | å¯¹è¯å†å² |

---

## N. ç½‘ç»œé€šä¿¡

### API ç«¯ç‚¹

| ç«¯ç‚¹ | ç”¨é€” |
|------|------|
| `https://api.openai.com/auth` | è®¤è¯ |
| `https://api.openai.com/profile` | ç”¨æˆ·ä¿¡æ¯ |
| `https://chatgpt.com/backend-api` | ChatGPT API |
| `https://chat.openai.com/ces/v1/telemetry/intake` | é¥æµ‹æ•°æ® |

### å¼€å‘è€…æ–‡æ¡£

- `https://developers.openai.com/codex/app`
- `https://developers.openai.com/codex/app/automations`
- `https://developers.openai.com/codex/skills`
- `https://developers.openai.com/codex/mcp`

---

## O. ç ”ç©¶æ€»ç»“

### æŠ€æœ¯äº®ç‚¹

1. **MCP åè®®** - CLI å†…ç½® MCP æœåŠ¡å™¨
2. **Cloud Tasks** - äº‘ç«¯ä»»åŠ¡ç®¡ç†
3. **Ollama é›†æˆ** - æœ¬åœ°æ¨¡å‹æ”¯æŒ

### æ¶æ„ç‰¹ç‚¹

1. **Rust CLI** - é«˜æ€§èƒ½å‘½ä»¤è¡Œ
2. **SQLite å­˜å‚¨** - æœ¬åœ°æ•°æ®æŒä¹…åŒ–
3. **WebSocket** - å®æ—¶é€šä¿¡

### ç»“è®º

Codex App æ˜¯ä¸€æ¬¾åŠŸèƒ½å®Œå–„çš„ AI ç¼–ç¨‹åŠ©æ‰‹æ¡Œé¢åº”ç”¨ï¼š

1. **ç‹¬ç«‹æ¡Œé¢åº”ç”¨** - ä¸ä¾èµ–ç‰¹å®š IDE
2. **å¤šä»»åŠ¡å¹¶è¡Œ** - Thread éš”ç¦»æ‰§è¡Œ
3. **å®šæ—¶è‡ªåŠ¨åŒ–** - RRule è°ƒåº¦ç³»ç»Ÿ
4. **æ‰©å±•æ€§å¼º** - Skills å’Œ MCP æ”¯æŒ

---

# ç¬¬äºŒéƒ¨åˆ†ï¼šæ·±åº¦ä»£ç åˆ†æ

---

## 1. Thread ç®¡ç†å™¨

Thread æ˜¯ Codex App ä¸­ç®¡ç†å¹¶è¡Œä»»åŠ¡çš„æ ¸å¿ƒæ¦‚å¿µã€‚

### Thread æ•°æ®ç»“æ„

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| threadId | string | çº¿ç¨‹å”¯ä¸€æ ‡è¯† |
| ephemeral | boolean | æ˜¯å¦ä¸ºä¸´æ—¶çº¿ç¨‹ |
| turnId | string | å½“å‰å›åˆ ID |

### Thread ç±»å‹

**æ™®é€š Thread**
- æŒä¹…åŒ–å­˜å‚¨
- å…³è” Git Worktree
- æ”¯æŒå†å²å›æº¯

**Ephemeral Thread**
- ä¸´æ—¶çº¿ç¨‹ï¼Œä¸æŒä¹…åŒ–
- ç”¨äºå¿«é€Ÿä»»åŠ¡
- è®¡æ•°å™¨: `pendingEphemeralThreadStarts`

### ã€ä»£ç è¯æ®ã€‘Thread åˆ›å»ºæµç¨‹

**æ¥æº**: `main-BLcwFbOH.js:60301-60328`

```javascript
async startThread(e) {
  await this.ensureReady();
  const n = this.options.sharedObjectRepository.get(
      "statsig_default_enable_features",
    ),
    r = FG(e, n);
  // ephemeral çº¿ç¨‹è®¡æ•°å™¨é€’å¢
  e.ephemeral === !0 && (this.pendingEphemeralThreadStarts += 1);
  const i = `thread/start:${Ft.randomUUID()}`,
    a = await this.sendInternalRequest({
      id: i,
      method: "thread/start",
      params: r,
    });
  try {
    if (a.error)
      throw new Error(
        a.error.message ?? `Failed to start thread (code ${a.error.code})`,
      );
    const o = a.result;
    // æ ‡è®° ephemeral çº¿ç¨‹
    return (e.ephemeral === !0 && this.markEphemeralThread(o.thread.id), o);
  } finally {
    // ephemeral çº¿ç¨‹è®¡æ•°å™¨é€’å‡
    e.ephemeral === !0 &&
      (this.pendingEphemeralThreadStarts = Math.max(
        0,
        this.pendingEphemeralThreadStarts - 1,
      ));
  }
}
```

### ã€ä»£ç è¯æ®ã€‘Ephemeral Thread è®¡æ•°å™¨

**æ¥æº**: `main-BLcwFbOH.js:60137-60138`

```javascript
// ç±»æˆå‘˜å˜é‡å®šä¹‰
ephemeralThreadTimeouts = new Map();
pendingEphemeralThreadStarts = 0;
```

### Worktree é›†æˆ

### ã€ä»£ç è¯æ®ã€‘Worktree è·¯å¾„è®¡ç®—

**æ¥æº**: `main-BLcwFbOH.js:30577-30607`

```javascript
// é»˜è®¤ worktree æ ¹ç›®å½•
function UF() {
  return te.join(Gn({}), "worktrees");
}

// åˆ›å»º worktree è·¯å¾„
async function EZ(t, e, n, r, i = UF()) {
  const o = (await e.getWorktreeRepository(n, r))?.root;
  if (!o) return { success: !1 };

  let s = te.join, c = te.relative, u = i;
  if (rt(r)) {
    const h = await Ga(r);
    // è¿œç¨‹æ¨¡å¼ä½¿ç”¨ posix è·¯å¾„
    ((s = te.posix.join), (c = te.posix.relative), (u = s(h, "worktrees")));
  }

  // ç”Ÿæˆå”¯ä¸€ ID (UUID å‰4ä½)
  const l = Ft.randomUUID().split("-")[0].slice(0, 4),
    p = te.basename(t),
    d = s(u, l, p),           // worktreeGitRoot
    f = c(o, n),
    m = s(d, f);              // worktreeWorkspaceRoot
  return { success: !0, worktreeGitRoot: d, worktreeWorkspaceRoot: m };
}
```

### ã€ä»£ç è¯æ®ã€‘Worktree åˆ›å»ºå‘½ä»¤

**æ¥æº**: `main-BLcwFbOH.js:30533-30541`

```javascript
// æ‰§è¡Œ git worktree add å‘½ä»¤
const p = await Be(t, ["worktree", "add", "--detach", e, c], i, {
  onStdoutRaw: o ? (f) => o("stdout", f) : void 0,
  onStderrRaw: o ? (f) => o("stderr", f) : void 0,
  signal: s,
});
if (!p.success)
  return {
    success: !1,
    error: new Error(`git worktree add failed: ${p.stderr || p.stdout}`),
  };
```

### Turn ç®¡ç†

### ã€ä»£ç è¯æ®ã€‘Turn äº‹ä»¶å¤„ç†

**æ¥æº**: `main-BLcwFbOH.js:29236-29271`

```javascript
const _ = s.onNotification((S) => {
  switch (S.method) {
    case "turn/started": {
      const y = S.params;
      if (l == null || y.threadId !== l) return;
      p = y.turn.id;
      return;
    }
    case "item/agentMessage/delta": {
      const y = S.params;
      if (l == null || y.threadId !== l) return;
      if (y.turnId == null) {
        if (p != null) return;
      } else if (p != null && y.turnId !== p) return;
      d = `${d ?? ""}${y.delta}`;
      return;
    }
    case "turn/completed": {
      const y = S.params;
      if (l == null || y.threadId !== l || (p != null && y.turn.id !== p))
        return;
      if (((p = y.turn.id), y.turn.status !== "completed")) {
        (f(), v(new Error("Structured turn did not complete.")));
        return;
      }
      (f(), h(c(d)));
      return;
    }
  }
});
```

### ã€ä»£ç è¯æ®ã€‘Turn ä¸­æ–­æœºåˆ¶

**æ¥æº**: `main-BLcwFbOH.js:29231-29233`

```javascript
// è¶…æ—¶æ—¶ä¸­æ–­ Turn
s.interruptTurn({ threadId: l, turnId: p }).catch(() => {}),
v(new Error("Timed out waiting for structured result."));
```

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **Worktree éš”ç¦»** - æ¯ä¸ª Thread ç‹¬ç«‹å·¥ä½œç›®å½•ï¼Œè·¯å¾„æ ¼å¼: `$CODEX_HOME/worktrees/<uuid4ä½>/<é¡¹ç›®å>`
2. **Turn æœºåˆ¶** - æ”¯æŒä¸­æ–­å’Œæ¢å¤ï¼Œé€šè¿‡ `turn/interrupt` æ–¹æ³•
3. **Ephemeral æ¨¡å¼** - ä¸´æ—¶ä»»åŠ¡ä¼˜åŒ–ï¼Œä½¿ç”¨ `pendingEphemeralThreadStarts` è®¡æ•°å™¨è·Ÿè¸ª

---

## 2. Automation è°ƒåº¦å™¨

Automation æ˜¯ Codex App çš„å®šæ—¶ä»»åŠ¡ç³»ç»Ÿï¼Œä½¿ç”¨ RRule æ ¼å¼å®šä¹‰è°ƒåº¦è§„åˆ™ã€‚

### ã€ä»£ç è¯æ®ã€‘æ•°æ®åº“ Schema

**æ¥æº**: `main-BLcwFbOH.js:23851-23862`

```sql
CREATE TABLE IF NOT EXISTS automations (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  prompt TEXT NOT NULL,
  status TEXT NOT NULL DEFAULT 'ACTIVE',
  next_run_at INTEGER,
  last_run_at INTEGER,
  cwds TEXT NOT NULL DEFAULT '[]',
  rrule TEXT NOT NULL DEFAULT '${av}',
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL
)
```

### ã€ä»£ç è¯æ®ã€‘automation_runs è¡¨ç»“æ„

**æ¥æº**: `main-BLcwFbOH.js:23877-23888`

```sql
CREATE TABLE IF NOT EXISTS automation_runs (
  thread_id TEXT PRIMARY KEY,
  automation_id TEXT NOT NULL,
  status TEXT NOT NULL,
  read_at INTEGER,
  thread_title TEXT,
  source_cwd TEXT,
  inbox_title TEXT,
  inbox_summary TEXT,
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL
)
```

### ã€ä»£ç è¯æ®ã€‘RRule éªŒè¯é€»è¾‘

**æ¥æº**: `main-BLcwFbOH.js:25306-25321`

```javascript
// æ£€æŸ¥ RRule æ˜¯å¦å¯å®Œå…¨è½¬æ¢ä¸ºæ–‡æœ¬
t.isFullyConvertible = function (e) {
  var n = !0;
  if (
    !(e.options.freq in t.IMPLEMENTED) ||
    (e.origOptions.until && e.origOptions.count)
  )
    return !1;
  for (var r in e.origOptions) {
    if (BD(["dtstart", "tzid", "wkst", "freq"], r)) return !0;
    if (!BD(t.IMPLEMENTED[e.options.freq], r)) return !1;
  }
  return n;
};

t.prototype.isFullyConvertible = function () {
  return t.isFullyConvertible(this.rrule);
};
```

### ã€ä»£ç è¯æ®ã€‘next_run_at è®¡ç®—é€»è¾‘

**æ¥æº**: `main-BLcwFbOH.js:28651-28678`

```javascript
// è®¡ç®—ä¸‹æ¬¡è¿è¡Œæ—¶é—´
const a = r.after(new Date(e), !1);
return a ? a.getTime() : null;

// æ›´æ–° automation çŠ¶æ€
function Ha(t, e) {
  if (!Mt()) return { ...t, nextRunAt: null, lastRunAt: null };
  const r = _F(t.id),
    i = Mi(t.rrule),
    a = r ? Mi(r.rrule) : null,
    o = r == null || a !== i || r.status !== t.status;
  let s = r?.nextRunAt ?? null;
  const c = r?.lastRunAt ?? null;
  // ACTIVE çŠ¶æ€æ—¶è®¡ç®—ä¸‹æ¬¡è¿è¡Œæ—¶é—´
  t.status === "ACTIVE"
    ? (s == null || o) && (s = wc({ rrule: i, now: e }))
    : (s = null);
  // ä¿å­˜åˆ°æ•°æ®åº“
  op({ automation: { ...t, rrule: i }, nextRunAt: s, lastRunAt: c });
  return { ...t, rrule: i, nextRunAt: s, lastRunAt: c };
}
```

### ã€ä»£ç è¯æ®ã€‘Automation æŒä¹…åŒ–

**æ¥æº**: `main-BLcwFbOH.js:28458-28478`

```javascript
function op({ automation: t, nextRunAt: e, lastRunAt: n }) {
  const r = Mt();
  if (r)
    try {
      r.prepare(
        "INSERT OR REPLACE INTO automations (id, name, prompt, status, next_run_at, last_run_at, cwds, rrule, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",
      ).run(
        t.id, t.name, t.prompt, t.status,
        e, n,
        JSON.stringify(t.cwds), t.rrule,
        t.createdAt, t.updatedAt,
      );
    } catch { return; }
}
```

### çŠ¶æ€ç®¡ç†

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| ACTIVE | æ´»è·ƒ |
| DELETED | å·²åˆ é™¤ |
| IN_PROGRESS | æ‰§è¡Œä¸­ |
| PENDING_REVIEW | å¾…å®¡æ ¸ |

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **RRule æ ‡å‡†** - ä½¿ç”¨ iCalendar è§„èŒƒï¼Œé€šè¿‡ `isFullyConvertible` éªŒè¯
2. **SQLite æŒä¹…åŒ–** - automations å’Œ automation_runs åŒè¡¨å­˜å‚¨
3. **Thread é›†æˆ** - è‡ªåŠ¨åˆ›å»ºæ‰§è¡Œçº¿ç¨‹ï¼Œé€šè¿‡ thread_id å…³è”

---

## 3. Skills åŠ è½½å™¨

Skills ç³»ç»Ÿå…è®¸ç”¨æˆ·æ‰©å±• Codex App çš„åŠŸèƒ½ã€‚

### Skills ç›®å½•ç»“æ„

```
~/.codex/skills/
â”œâ”€â”€ skill-name/
â”‚   â”œâ”€â”€ SKILL.md      # æŠ€èƒ½æè¿°
â”‚   â””â”€â”€ agents/
â”‚       â””â”€â”€ openai.yaml
```

### ã€ä»£ç è¯æ®ã€‘Skill å…ƒæ•°æ®æ˜ å°„

**æ¥æº**: `main-BLcwFbOH.js:33062-33074`

```javascript
const TR = {
  name: "name",
  description: "description",
  "short-description": "shortDescription",
  short_description: "shortDescription",
  shortDescription: "shortDescription",
  "icon-small": "iconSmall",
  icon_small: "iconSmall",
  iconSmall: "iconSmall",
  "icon-large": "iconLarge",
  icon_large: "iconLarge",
  iconLarge: "iconLarge",
};
```

### ã€ä»£ç è¯æ®ã€‘SKILL.md åŠ è½½é€»è¾‘

**æ¥æº**: `main-BLcwFbOH.js:33028-33057`

```javascript
i.map(async (o) => {
  if (o.startsWith(".")) return null;
  const s = n.join(t, o),
    u = (await Ke.stat(s, r)).isDirectory(),
    l = u ? n.join(s, "SKILL.md") : s;  // ç›®å½•åˆ™è¯»å– SKILL.md
  if (!(await er(l, r))) return null;
  const p = await Ke.readFile(l, r),
    d = H9(p),  // è§£æ SKILL.md å†…å®¹
    f = await Y9({ path: n, hostConfig: r, skillRoot: s }),  // è¯»å– openai.yaml
    m = u ? o : n.parse(o).name,
    h = d.description ?? d.shortDescription ?? m;
  return {
    id: m,
    name: d.name ?? m,
    description: h,
    shortDescription: d.shortDescription ?? f.shortDescription,
    iconSmall: v.iconSmall,
    iconLarge: v.iconLarge,
    repoPath: g,
  };
})
```

### ã€ä»£ç è¯æ®ã€‘openai.yaml è§£æ

**æ¥æº**: `main-BLcwFbOH.js:33125-33153`

```javascript
async function Y9({ path: t, hostConfig: e, skillRoot: n }) {
  const r = t.join(n, "agents", "openai.yaml");
  if (!(await er(r, e)))
    return { shortDescription: null, iconSmall: null, iconLarge: null };
  const i = await Ke.readFile(r, e);
  return Z9(i);
}

function Z9(t) {
  const e = { shortDescription: null, iconSmall: null, iconLarge: null },
    n = t.split(/\r?\n/);
  let r = !1;
  for (const i of n) {
    if (!r) {
      i.trim() === "interface:" && (r = !0);  // æŸ¥æ‰¾ interface: æ®µ
      continue;
    }
    if (/^\S/.test(i) || !/^\s+/.test(i)) break;  // é‡åˆ°éç¼©è¿›è¡Œåˆ™ç»“æŸ
    const a = i.trim();
    const o = a.indexOf(":");
    if (o === -1) continue;
    const s = a.slice(0, o).trim(),
      c = a.slice(o + 1).trim(),
      u = W9[s];
    if (!u || c.length === 0) continue;
    e[u] = _v(c);
  }
  return e;
}
```

### ã€ä»£ç è¯æ®ã€‘å›¾æ ‡æœç´¢ä¼˜å…ˆçº§

**æ¥æº**: `main-BLcwFbOH.js:33167-33199`

```javascript
// Small å›¾æ ‡æœç´¢é¡ºåº
const c = i ?? (await xR(s, e, [
  `${r}-small.svg`,
  `${r}-small.png`,
  "small.svg",
  "small.png",
  `${r}.svg`,
  `${r}.png`,
  "icon-small.svg",
  "icon-small.png",
], t));

// Large å›¾æ ‡æœç´¢é¡ºåº
const u = a ?? (await xR(s, e, [
  `${r}.png`,
  `${r}.svg`,
  "icon.png",
  "icon.svg",
  `${r}-large.png`,
  `${r}-large.svg`,
], t));
```

### ã€ä»£ç è¯æ®ã€‘å®˜æ–¹ä»“åº“ Sparse Clone

**æ¥æº**: `main-BLcwFbOH.js:33217-33240`

```javascript
// Sparse Clone å‘½ä»¤
const i = await Be(e,
  ["clone", "--depth", "1", "--filter=blob:none", "--sparse", j9, t],
  n, { timeoutMs: ul }
);

// æ›´æ–°ä»“åº“
async function J9(t, e) {
  const n = await Be(t, ["fetch", "--depth", "1", "origin", B9], e, {
    timeoutMs: ul,
  });
  const r = await Be(t, ["reset", "--hard", "FETCH_HEAD"], e, {
    timeoutMs: ul,
  });
}

// Sparse Checkout è®¾ç½®
async function Q9(t, e, n) {
  const r = await Be(t, ["sparse-checkout", "set", ...e.map((i) => eK(i))], n, {
    timeoutMs: ul,
  });
}
```

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **YAML é…ç½®** - ä½¿ç”¨ openai.yaml å®šä¹‰ Agentï¼Œè§£æ `interface:` æ®µ
2. **Sparse Checkout** - æŒ‰éœ€ä¸‹è½½å®˜æ–¹ Skillsï¼Œä½¿ç”¨ `--filter=blob:none`
3. **å›¾æ ‡è‡ªåŠ¨å‘ç°** - æ”¯æŒå¤šç§å‘½åçº¦å®šï¼ŒæŒ‰ä¼˜å…ˆçº§æœç´¢
3. **å›¾æ ‡è‡ªåŠ¨å‘ç°** - å¤šç§å‘½åçº¦å®šæ”¯æŒ

---

## 4. IPC æ¶ˆæ¯è·¯ç”±

Codex App ä½¿ç”¨ Electron IPC æœºåˆ¶å®ç°ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚

### ã€ä»£ç è¯æ®ã€‘IPC é€šé“å®šä¹‰

**æ¥æº**: `main-BLcwFbOH.js:36946-36960`

```javascript
// æ ¸å¿ƒ IPC é€šé“
h7 = "codex_desktop:message-from-view",    // æ¸²æŸ“è¿›ç¨‹ -> ä¸»è¿›ç¨‹
bt = "codex_desktop:message-for-view",     // ä¸»è¿›ç¨‹ -> æ¸²æŸ“è¿›ç¨‹
g0 = "codex_desktop:show-context-menu",    // å³é”®èœå•
g7 = "codex_desktop:get-sentry-init-options",  // Sentry é…ç½®
v7 = "codex_desktop:get-build-flavor",     // æ„å»ºç±»å‹
_7 = "codex_desktop:trigger-sentry-test",  // Sentry æµ‹è¯•

// Worker ä¸“ç”¨é€šé“ (åŠ¨æ€ç”Ÿæˆ)
function T7(t) {
  return `codex_desktop:worker:${t}:from-view`;
}
function x7(t) {
  return `codex_desktop:worker:${t}:for-view`;
}
```

### ã€ä»£ç è¯æ®ã€‘IPC æ¶ˆæ¯å¤„ç†å‡½æ•°

**æ¥æº**: `main-BLcwFbOH.js:71579-71601`

```javascript
// ä¸»æ¶ˆæ¯å¤„ç†
L.ipcMain.handle(h7, async (t, e) => {
  if (!Ji(t)) return;  // éªŒè¯äº‹ä»¶æ¥æº
  const n = Vt.getContextForWebContents(t.sender);
  if (!n) {
    Xt().warning("Message received for unknown window context");
    return;
  }
  await n.handleMessage(t.sender, e);
});

// Worker æ¶ˆæ¯å¤„ç†
for (const t of aq) {
  const e = new oce(t);
  L.ipcMain.handle(T7(t), async (n, r) => {
    Ji(n) && (await e.handleMessage(n.sender, r));
  });
}
```

### ã€ä»£ç è¯æ®ã€‘electronBridge å®Œæ•´ API

**æ¥æº**: `preload.js:1` (æ ¼å¼åŒ–å)

```javascript
const R = {
  windowType: "electron",

  // å‘é€æ¶ˆæ¯åˆ°ä¸»è¿›ç¨‹
  sendMessageFromView: async (e) => {
    await n.ipcRenderer.invoke(f, e)
  },

  // è·å–æ–‡ä»¶è·¯å¾„
  getPathForFile: (e) => {
    const t = n.webUtils.getPathForFile(e);
    return t || null;
  },

  // Worker æ¶ˆæ¯å‘é€
  sendWorkerMessageFromView: async (e, t) => {
    await n.ipcRenderer.invoke(M(e), t)
  },

  // Worker æ¶ˆæ¯è®¢é˜…
  subscribeToWorkerMessages: (e, t) => {
    let s = r.get(e);
    s || (s = new Set, r.set(e, s));
    let o = d.get(e);
    return o || (
      o = (i, c) => {
        const a = r.get(e);
        a && a.forEach(E => { E(c) });
      },
      d.set(e, o),
      n.ipcRenderer.on(p(e), o)
    ),
    s.add(t),
    () => { /* å–æ¶ˆè®¢é˜…é€»è¾‘ */ };
  },

  // å³é”®èœå•
  showContextMenu: async (e) => n.ipcRenderer.invoke(g, e),

  // Sentry æµ‹è¯•
  triggerSentryTestError: async () => {
    await n.ipcRenderer.invoke(w)
  },

  // è·å–é…ç½®
  getSentryInitOptions: () => _,
  getAppSessionId: () => _.codexAppSessionId,
  getBuildFlavor: () => x
};

// æš´éœ²åˆ°æ¸²æŸ“è¿›ç¨‹
n.contextBridge.exposeInMainWorld("codexWindowType", l);
n.contextBridge.exposeInMainWorld("electronBridge", R);
```

### ã€ä»£ç è¯æ®ã€‘æ¶ˆæ¯è½¬å‘åˆ°çª—å£

**æ¥æº**: `preload.js` (æ¶ˆæ¯ç›‘å¬)

```javascript
// ç›‘å¬ä¸»è¿›ç¨‹æ¶ˆæ¯å¹¶è½¬å‘åˆ° window
n.ipcRenderer.on(v, (e, t) => {
  window.dispatchEvent(new MessageEvent("message", { data: t }));
});
```

### IPC é€šé“å®Œæ•´åˆ—è¡¨

| é€šé“ | æ–¹å‘ | è¯´æ˜ |
|------|------|------|
| `codex_desktop:message-from-view` | Renderer â†’ Main | ä¸»æ¶ˆæ¯é€šé“ |
| `codex_desktop:message-for-view` | Main â†’ Renderer | ä¸»æ¶ˆæ¯é€šé“ |
| `codex_desktop:show-context-menu` | Renderer â†’ Main | å³é”®èœå• |
| `codex_desktop:get-sentry-init-options` | Renderer â†’ Main | Sentry é…ç½® |
| `codex_desktop:get-build-flavor` | Renderer â†’ Main | æ„å»ºç±»å‹ |
| `codex_desktop:trigger-sentry-test` | Renderer â†’ Main | Sentry æµ‹è¯• |
| `codex_desktop:check-for-updates` | Renderer â†’ Main | æ£€æŸ¥æ›´æ–° |
| `codex_desktop:worker:${id}:from-view` | Renderer â†’ Main | Worker æ¶ˆæ¯ |
| `codex_desktop:worker:${id}:for-view` | Main â†’ Renderer | Worker æ¶ˆæ¯ |

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **åŒå‘é€šé“** - from-view/for-view æ¨¡å¼ï¼Œä½¿ç”¨ MessageEvent è½¬å‘
2. **Worker éš”ç¦»** - æ¯ä¸ª Worker ç‹¬ç«‹é€šé“ï¼Œé€šè¿‡ ID åŒºåˆ†
3. **Context Bridge** - å®‰å…¨æš´éœ² APIï¼Œä½¿ç”¨ `exposeInMainWorld`

---

## 5. SQLite æ•°æ®è®¿é—®å±‚

Codex App ä½¿ç”¨ better-sqlite3 åº“è¿›è¡Œæœ¬åœ°æ•°æ®æŒä¹…åŒ–ã€‚

### ã€ä»£ç è¯æ®ã€‘better-sqlite3 åŠ è½½

**æ¥æº**: `main-BLcwFbOH.js:23815-23817`

```javascript
return require("better-sqlite3");
// å¦‚æœä¸åœ¨ Electron ç¯å¢ƒä¸­
throw new Error("better-sqlite3 is only bundled with the Electron app");
```

### ã€ä»£ç è¯æ®ã€‘inbox_items è¡¨ç»“æ„

**æ¥æº**: `main-BLcwFbOH.js:23825-23836`

```sql
CREATE TABLE IF NOT EXISTS inbox_items (
  id TEXT PRIMARY KEY,
  title TEXT,
  description TEXT,
  thread_id TEXT,
  read_at INTEGER,
  created_at INTEGER
)
```

### ã€ä»£ç è¯æ®ã€‘è¿ç§»ç‰ˆæœ¬åˆ—è¡¨

**æ¥æº**: `main-BLcwFbOH.js:23821-23937`

| ç‰ˆæœ¬ | æ“ä½œ |
|------|------|
| 1 | åˆ›å»º inbox_items è¡¨ |
| 2-3 | æ·»åŠ  inbox_items åˆ— (description, thread_id, read_at, created_at) |
| 7 | åˆ›å»º automations è¡¨ |
| 8 | æ·»åŠ  automations.next_run_at åˆ— |
| 9 | åˆ›å»º automation_runs è¡¨ |
| 13 | æ·»åŠ  automations.rrule åˆ— |
| 14 | æ·»åŠ  automation_runs å½’æ¡£æ¶ˆæ¯åˆ— |
| 15 | æ·»åŠ  automation_runs.read_at åˆ— |
| 16 | æ·»åŠ  automation_runs.thread_title åˆ— |
| 17 | æ·»åŠ  automation_runs.source_cwd åˆ— |
| 18 | æ·»åŠ  automation_runs inbox åˆ— |
| 19 | æ·»åŠ  automation_runs.archived_reason åˆ— |

### ã€ä»£ç è¯æ®ã€‘è¿ç§»æ‰§è¡Œæœºåˆ¶

**æ¥æº**: `main-BLcwFbOH.js:23941-23952`

```javascript
const n = KH(t);  // è·å–å½“å‰ç‰ˆæœ¬
for (const r of e)
  if (!(r.version <= n)) {
    t.prepare("BEGIN").run();
    try {
      r.up();
      t.prepare(`PRAGMA user_version = ${r.version}`).run();
      t.prepare("COMMIT").run();
    } catch (i) {
      throw (t.prepare("ROLLBACK").run(), i);  // å›æ»šäº‹åŠ¡
    }
  }
```

### ã€ä»£ç è¯æ®ã€‘åˆ—æ·»åŠ è¾…åŠ©å‡½æ•°

**æ¥æº**: `main-BLcwFbOH.js:23954-23959`

```javascript
function Ot(t, e, n, r) {
  // æ£€æŸ¥åˆ—æ˜¯å¦å­˜åœ¨
  t.prepare(`PRAGMA table_info(${e})`)
    .all()
    .some((s) => s?.name === n) ||
    // ä¸å­˜åœ¨åˆ™æ·»åŠ 
    t.exec(`ALTER TABLE ${e} ADD COLUMN ${n} ${r}`);
}
```

### ã€ä»£ç è¯æ®ã€‘ç‰ˆæœ¬è·å–å‡½æ•°

**æ¥æº**: `main-BLcwFbOH.js:23961-23963`

```javascript
function KH(t) {
  const e = t.prepare("PRAGMA user_version").get();
  return typeof e?.user_version == "number" ? e.user_version : 0;
}
```

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **ç‰ˆæœ¬è¿ç§»** - PRAGMA user_version ç®¡ç†ï¼Œå½“å‰æœ€é«˜ç‰ˆæœ¬ 19
2. **äº‹åŠ¡ä¿æŠ¤** - BEGIN/COMMIT/ROLLBACK ç¡®ä¿åŸå­æ€§
3. **å¢é‡è¿ç§»** - åªæ‰§è¡Œæœªåº”ç”¨çš„ç‰ˆæœ¬ï¼Œæ”¯æŒåˆ—å­˜åœ¨æ€§æ£€æŸ¥
3. **å¢é‡è¿ç§»** - åªæ‰§è¡Œæœªåº”ç”¨çš„ç‰ˆæœ¬

---

## 6. WebSocket å®¢æˆ·ç«¯

Codex App ä½¿ç”¨ WebSocket ä¸ App Server è¿›è¡Œå®æ—¶é€šä¿¡ã€‚

### ã€ä»£ç è¯æ®ã€‘WebSocket å®¢æˆ·ç«¯å®Œæ•´å®ç°

**æ¥æº**: `main-BLcwFbOH.js:59910-59977`

```javascript
const Yce = 1;  // WebSocket.OPEN çŠ¶æ€å¸¸é‡
class Zce {
  constructor(e) {
    this.options = e;
  }
  kind = "websocket";
  ws = null;
  async start() {
    await new Promise((e, n) => {
      const r = globalThis.WebSocket;
      if (!r) {
        n(new Error("WebSocket is not available in this runtime"));
        return;
      }
      const i = new r(this.options.websocketUrl, {
        headers: this.options.headers,
      });
      this.ws = i;
      let a = !1;
      const o = (s) => {
        a || ((a = !0), n(s));
      };
      // äº‹ä»¶å¤„ç†
      i.onopen = () => { a || ((a = !0), e()); };
      i.onerror = () => {
        const s = new Error("Codex app-server websocket encountered an error");
        (this.options.onErrorMessage(s.message), o(s));
      };
      i.onmessage = (s) => {
        const c = s.data;
        for (const u of iue(c)) this.options.onMessageLine(u);
      };
      i.onclose = (s) => {
        const c = aue(s);
        this.options.onClosed({ kind: "websocket", code: c.code, reason: c.reason });
        o(new Error(`Codex app-server websocket closed (code=${c.code ?? "unknown"})`));
      };
    });
  }
  send(e) {
    if (!this.ws || this.ws.readyState !== Yce)
      throw new Error("Codex app-server websocket is not available");
    this.ws.send(JSON.stringify(e));
  }
  stop() {
    if (this.ws) {
      this.ws.onopen = null;
      this.ws.onmessage = null;
      this.ws.onerror = null;
      this.ws.onclose = null;
      try { this.ws.close(); } catch {}
      this.ws = null;
    }
  }
}
```

### ã€ä»£ç è¯æ®ã€‘URL æ„å»ºé€»è¾‘

**æ¥æº**: `main-BLcwFbOH.js:59984-60012`

```javascript
function Xce(t) {
  if (process.env.CODEX_APP_SERVER_FORCE_CLI === "1") return null;
  const e = process.env.CODEX_APP_SERVER_WS_URL ?? t.websocket_url;
  return !e || typeof e != "string" ? null : Jce(e);
}

function Jce(t) {
  const e = t.trim();
  if (!e) return null;
  // è‡ªåŠ¨æ·»åŠ  wss:// åè®®
  const r = /^[a-z][a-z0-9+.-]*:\/\//i.test(e) ? e : `wss://${e}`;
  let i;
  try { i = new URL(r); } catch { return null; }
  // åè®®è½¬æ¢: https -> wss, http -> ws
  if (i.protocol === "https:") i.protocol = "wss:";
  else if (i.protocol === "http:") i.protocol = "ws:";
  if (i.protocol !== "ws:" && i.protocol !== "wss:") return null;
  // è‡ªåŠ¨æ·»åŠ  /rpc è·¯å¾„
  const a = i.pathname || "/";
  a === "/" || a.length === 0
    ? (i.pathname = "/rpc")
    : a.endsWith("/rpc") || (i.pathname = `${a.replace(/\/$/, "")}/rpc`);
  return i.toString();
}
```

### ã€ä»£ç è¯æ®ã€‘æ¶ˆæ¯è§£æå‡½æ•°

**æ¥æº**: `main-BLcwFbOH.js:60062-60082`

```javascript
// æ¶ˆæ¯è¡Œè§£æ - æ”¯æŒå¤šç§æ•°æ®æ ¼å¼
function iue(t) {
  if (t == null) return [];
  let e = null;
  if (typeof t == "string") e = t;
  else if (t instanceof ArrayBuffer)
    e = Buffer.from(t).toString("utf8");
  else if (ArrayBuffer.isView(t))
    e = Buffer.from(t.buffer, t.byteOffset, t.byteLength).toString("utf8");
  return e ? e.split(/\r?\n/).filter((r) => r.trim().length > 0) : [];
}

// å…³é—­äº‹ä»¶è§£æ
function aue(t) {
  if (!t || typeof t != "object") return { code: null, reason: null };
  const e = typeof t.code == "number" ? t.code : null,
    n = typeof t.reason == "string" ? t.reason : null;
  return { code: e, reason: n };
}
```

### ã€ä»£ç è¯æ®ã€‘ä¼ è¾“å±‚å…³é—­å¤„ç†

**æ¥æº**: `main-BLcwFbOH.js:60579-60617`

```javascript
handleTransportClosed(e) {
  let n = null;
  if (e.kind === "stdio") {
    // stdio ä¼ è¾“å…³é—­å¤„ç†
    const r = this.isAppQuitting &&
      (e.signal === "SIGHUP" || e.signal === "SIGTERM" || e.signal === "SIGINT");
    n = e.code === 0 || r ? null
      : `Codex app-server exited unexpectedly (code=${e.code}, signal=${e.signal}).
Most recent error: ${this.mostRecentErrorMessage ?? "None"}`;
  } else {
    // WebSocket ä¼ è¾“å…³é—­å¤„ç†
    const r = e.reason ? ` reason=${e.reason}` : "";
    n = e.code === 1000 || this.isAppQuitting ? null  // 1000 = æ­£å¸¸å…³é—­
      : `Codex app-server websocket closed unexpectedly (code=${e.code ?? "unknown"}${r}).
Most recent error: ${this.mostRecentErrorMessage ?? "None"}`;
  }
  n && this.broadcastFatalError(n);
  // æ¸…ç†èµ„æº
  this.stopProcess();
}
```

### ã€ä»£ç è¯æ®ã€‘stdio ä¼ è¾“å±‚å¯¹æ¯”

**æ¥æº**: `main-BLcwFbOH.js:59796-59837`

```javascript
class Vce {
  constructor(e) {
    this.options = e;
    this.stdoutLineFramer = new $ce((n) => {
      this.options.onMessageLine(n);
    });
  }
  kind = "stdio";
  proc = null;
  async start() {
    const e = Sn.spawn(this.options.executablePath, this.options.args, {
      stdio: ["pipe", "pipe", "pipe"],
      env: this.options.env,
    });
    if (!e.pid)
      throw new Error(`Failed to spawn Codex CLI at ${this.options.executablePath}`);
    this.proc = e;
    e.on("exit", (n, r) => {
      this.options.onClosed({ kind: "stdio", code: n, signal: r ?? null });
    });
  }
  send(e) {
    if (!this.proc || !this.proc.stdin || this.proc.stdin.destroyed)
      throw new Error("Codex app-server process is not available");
    this.proc.stdin.write(`${JSON.stringify(e)}\n`);
  }
}
```

### ä¼ è¾“å±‚é€‰æ‹©

| ç¯å¢ƒå˜é‡ | è¯´æ˜ |
|----------|------|
| CODEX_APP_SERVER_WS_URL | WebSocket URL |
| CODEX_APP_SERVER_FORCE_CLI | å¼ºåˆ¶ä½¿ç”¨ CLI (stdio) |

### WebSocket å…³é—­ç 

| ç  | è¯´æ˜ |
|----|------|
| 1000 | æ­£å¸¸å…³é—­ |
| å…¶ä»– | å¼‚å¸¸å…³é—­ï¼Œè§¦å‘é”™è¯¯å¹¿æ’­ |

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **åŒä¼ è¾“å±‚** - WebSocket (å®æ—¶) å’Œ stdio (CLI è¿›ç¨‹)
2. **è‡ªåŠ¨åè®®è½¬æ¢** - httpsâ†’wss, httpâ†’ws
3. **è‡ªåŠ¨è·¯å¾„è¡¥å…¨** - è‡ªåŠ¨æ·»åŠ  /rpc ç«¯ç‚¹
4. **æ¶ˆæ¯è¡Œåˆ†å¸§** - æ”¯æŒ string/ArrayBuffer/ArrayBufferView
5. **ä¼˜é›…å…³é—­** - åŒºåˆ†æ­£å¸¸å…³é—­(1000)å’Œå¼‚å¸¸å…³é—­

---

## 7. CLI Rust æ¨¡å—

Codex CLI ä½¿ç”¨ Rust ç¼–å†™ï¼Œä½äº codex-rs/ ç›®å½•ä¸‹ã€‚

### ã€ä»£ç è¯æ®ã€‘æ ¸å¿ƒæ¨¡å—æºæ–‡ä»¶åˆ—è¡¨

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
core/src/
â”œâ”€â”€ agent/control.rs          # Agent æ§åˆ¶
â”œâ”€â”€ analytics_client.rs       # åˆ†æå®¢æˆ·ç«¯
â”œâ”€â”€ apply_patch.rs            # è¡¥ä¸åº”ç”¨
â”œâ”€â”€ auth.rs                   # è®¤è¯æ¨¡å—
â”œâ”€â”€ bash.rs                   # Bash æ‰§è¡Œ
â”œâ”€â”€ client.rs                 # API å®¢æˆ·ç«¯
â”œâ”€â”€ codex_delegate.rs         # å§”æ‰˜å¤„ç†
â”œâ”€â”€ codex_thread.rs           # çº¿ç¨‹ç®¡ç†
â”œâ”€â”€ codex.rs                  # ä¸»å…¥å£
â”œâ”€â”€ command_safety/
â”‚   â”œâ”€â”€ is_dangerous_command.rs  # å±é™©å‘½ä»¤æ£€æµ‹
â”‚   â””â”€â”€ is_safe_command.rs       # å®‰å…¨å‘½ä»¤æ£€æµ‹
â”œâ”€â”€ compact_remote.rs         # è¿œç¨‹å‹ç¼©
â”œâ”€â”€ compact.rs                # ä¸Šä¸‹æ–‡å‹ç¼©
â”œâ”€â”€ config_loader/
â”‚   â”œâ”€â”€ cloud_requirements.rs # äº‘ç«¯éœ€æ±‚
â”‚   â”œâ”€â”€ diagnostics.rs        # è¯Šæ–­
â”‚   â”œâ”€â”€ layer_io.rs           # å±‚çº§ IO
â”‚   â”œâ”€â”€ macos.rs              # macOS é…ç½®
â”‚   â”œâ”€â”€ mod.rs                # æ¨¡å—å…¥å£
â”‚   â””â”€â”€ state.rs              # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ edit.rs               # é…ç½®ç¼–è¾‘
â”‚   â””â”€â”€ mod.rs                # é…ç½®æ¨¡å—
â”œâ”€â”€ context_manager/
â”‚   â”œâ”€â”€ history.rs            # å†å²ç®¡ç†
â”‚   â””â”€â”€ normalize.rs          # è§„èŒƒåŒ–
â”œâ”€â”€ custom_prompts.rs         # è‡ªå®šä¹‰æç¤ºè¯
â”œâ”€â”€ default_client.rs         # é»˜è®¤å®¢æˆ·ç«¯
â”œâ”€â”€ exec_policy.rs            # æ‰§è¡Œç­–ç•¥
â”œâ”€â”€ exec.rs                   # å‘½ä»¤æ‰§è¡Œ
â”œâ”€â”€ file_watcher.rs           # æ–‡ä»¶ç›‘è§†
â”œâ”€â”€ git_info.rs               # Git ä¿¡æ¯
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ registry.rs           # é’©å­æ³¨å†Œ
â”‚   â”œâ”€â”€ types.rs              # é’©å­ç±»å‹
â”‚   â””â”€â”€ user_notification.rs  # ç”¨æˆ·é€šçŸ¥
â”œâ”€â”€ landlock.rs               # Linux æ²™ç®±
â”œâ”€â”€ mcp/
â”‚   â”œâ”€â”€ auth.rs               # MCP è®¤è¯
â”‚   â”œâ”€â”€ mod.rs                # MCP æ¨¡å—
â”‚   â””â”€â”€ skill_dependencies.rs # æŠ€èƒ½ä¾èµ–
â”œâ”€â”€ mcp_connection_manager.rs # MCP è¿æ¥ç®¡ç†
â”œâ”€â”€ mcp_tool_call.rs          # MCP å·¥å…·è°ƒç”¨
â”œâ”€â”€ project_doc.rs            # é¡¹ç›®æ–‡æ¡£ (AGENTS.md)
â”œâ”€â”€ seatbelt.rs               # macOS æ²™ç®±
â”œâ”€â”€ stream_events_utils.rs    # æµäº‹ä»¶å·¥å…·
â””â”€â”€ tools/
    â”œâ”€â”€ parallel.rs           # å¹¶è¡Œå·¥å…·
    â””â”€â”€ registry.rs           # å·¥å…·æ³¨å†Œ
```

### ã€ä»£ç è¯æ®ã€‘App Server æ¨¡å—æºæ–‡ä»¶

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
app-server/src/
â”œâ”€â”€ bespoke_event_handling.rs  # äº‹ä»¶å¤„ç†
â”œâ”€â”€ codex_message_processor.rs # Codex æ¶ˆæ¯å¤„ç†
â”œâ”€â”€ dynamic_tools.rs           # åŠ¨æ€å·¥å…·
â”œâ”€â”€ fuzzy_file_search.rs       # æ¨¡ç³Šæ–‡ä»¶æœç´¢
â”œâ”€â”€ message_processor.rs       # æ¶ˆæ¯å¤„ç†å™¨
â”œâ”€â”€ outgoing_message.rs        # å‡ºç«™æ¶ˆæ¯
â””â”€â”€ lib.rs                     # åº“å…¥å£
```

### ã€ä»£ç è¯æ®ã€‘ç¯å¢ƒå˜é‡åˆ—è¡¨

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

| ç¯å¢ƒå˜é‡ | è¯´æ˜ |
|----------|------|
| CODEX_HOME | Codex ä¸»ç›®å½• |
| CODEX_SANDBOX | æ²™ç®±æ¨¡å¼ |
| CODEX_APPLY_GIT_CFG | åº”ç”¨ Git é…ç½® |
| CODEX_TUI_ROUNDED | TUI åœ†è§’æ ·å¼ |
| CODEX_OSS_BASE_URL | OSS åŸºç¡€ URL |
| CODEX_OSS_PORT | OSS ç«¯å£ |
| CODEX_CLOUD_TASKS_MODE | äº‘ä»»åŠ¡æ¨¡å¼ |
| CODEX_CLOUD_TASKS_BASE_URL | äº‘ä»»åŠ¡åŸºç¡€ URL |
| OPENAI_BASE_URL | OpenAI API åŸºç¡€ URL |
| OPENAI_ORGANIZATION | OpenAI ç»„ç»‡ ID |
| OPENAI_PROJECT | OpenAI é¡¹ç›® ID |

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **æ¨¡å—åŒ–** - åŠŸèƒ½æŒ‰èŒè´£åˆ†ç¦»
2. **æ²™ç®±æ”¯æŒ** - landlock (Linux) / seatbelt (macOS)
3. **åè®®åˆ†å±‚** - v1/v2 ç‰ˆæœ¬å…¼å®¹

### ã€ä»£ç è¯æ®ã€‘CLI å­å‘½ä»¤åˆ—è¡¨

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

| å­å‘½ä»¤ | è¯´æ˜ |
|--------|------|
| `codex` | éäº¤äº’å¼è¿è¡Œ |
| `codex login` | ç®¡ç†ç™»å½• |
| `codex logout` | ç§»é™¤è®¤è¯å‡­æ® |
| `codex mcp` | MCP æœåŠ¡å™¨ç®¡ç† |
| `codex mcp add` | æ·»åŠ  MCP æœåŠ¡å™¨ |
| `codex mcp login` | MCP OAuth ç™»å½• |
| `codex mcp logout` | MCP OAuth ç™»å‡º |
| `codex mcp remove` | ç§»é™¤ MCP æœåŠ¡å™¨ |
| `codex cloud` | äº‘ä»»åŠ¡ TUI æµè§ˆå™¨ |
| `codex cloud exec` | æäº¤äº‘ä»»åŠ¡ |
| `codex cloud list` | åˆ—å‡ºäº‘ä»»åŠ¡ |
| `codex cloud status` | æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ |
| `codex cloud diff` | æŸ¥çœ‹ä»»åŠ¡ diff |
| `codex cloud apply` | åº”ç”¨ä»»åŠ¡ diff |
| `codex app` | å¯åŠ¨æ¡Œé¢åº”ç”¨ |
| `codex resume` | æ¢å¤ä¹‹å‰çš„ä¼šè¯ |
| `codex fork` | åˆ†å‰ä¹‹å‰çš„ä¼šè¯ |
| `codex review` | éäº¤äº’å¼ä»£ç å®¡æŸ¥ |
| `codex debug` | è°ƒè¯•å·¥å…· |
| `codex completions` | ç”Ÿæˆ shell è¡¥å…¨è„šæœ¬ |

### ã€ä»£ç è¯æ®ã€‘åè®®ç±»å‹å®šä¹‰

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```rust
// åè®®ç‰ˆæœ¬
codex_app_server_protocol::protocol::v1::Tools
codex_app_server_protocol::protocol::v1::Profile
codex_app_server_protocol::protocol::v2::ProfileV2
codex_app_server_protocol::protocol::v2::TurnError
codex_app_server_protocol::protocol::v2::ConfigEdit
codex_app_server_protocol::protocol::v2::SkillScope
codex_app_server_protocol::protocol::v2::ThreadItem
codex_app_server_protocol::protocol::v2::TurnStatus
codex_app_server_protocol::protocol::v2::SandboxMode
codex_app_server_protocol::protocol::v2::NetworkAccess
codex_app_server_protocol::protocol::v2::SandboxPolicy
codex_app_server_protocol::protocol::common::GitSha
```

---

## 8. MCP åè®®

Codex App å®ç°äº† Model Context Protocol (MCP) ç”¨äºå·¥å…·æ‰©å±•ã€‚

### ã€ä»£ç è¯æ®ã€‘MCP æœåŠ¡å™¨æ¨¡å—æºæ–‡ä»¶

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
mcp-server/src/
â”œâ”€â”€ codex_tool_config.rs      # Codex å·¥å…·é…ç½®
â”œâ”€â”€ codex_tool_runner.rs      # Codex å·¥å…·è¿è¡Œå™¨
â”œâ”€â”€ exec_approval.rs          # æ‰§è¡Œå®¡æ‰¹
â”œâ”€â”€ lib.rs                    # åº“å…¥å£
â”œâ”€â”€ message_processor.rs      # æ¶ˆæ¯å¤„ç†å™¨
â”œâ”€â”€ outgoing_message.rs       # å‡ºç«™æ¶ˆæ¯
â””â”€â”€ patch_approval.rs         # è¡¥ä¸å®¡æ‰¹
```

### ã€ä»£ç è¯æ®ã€‘MCP å·¥å…·é…ç½®å‚æ•°

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```rust
// CodexToolCallParam - Codex å·¥å…·è°ƒç”¨å‚æ•°
struct CodexToolCallParam {
    prompt: String,              // åˆå§‹ç”¨æˆ·æç¤º
    model: Option<String>,       // æ¨¡å‹åç§° (å¦‚ 'gpt-5.2')
    profile: Option<String>,     // é…ç½®æ–‡ä»¶
    cwd: Option<String>,         // å·¥ä½œç›®å½•
    approval_policy: Option<ApprovalPolicy>,  // å®¡æ‰¹ç­–ç•¥
    sandbox_mode: Option<SandboxMode>,        // æ²™ç®±æ¨¡å¼
    base_instructions: Option<String>,        // åŸºç¡€æŒ‡ä»¤
    developer_instructions: Option<String>,   // å¼€å‘è€…æŒ‡ä»¤
    compact_prompt: Option<String>,           // å‹ç¼©æç¤º
}

// CodexToolCallReplyParam - ç»§ç»­å¯¹è¯å‚æ•°
struct CodexToolCallReplyParam {
    thread_id: String,           // çº¿ç¨‹ ID (å¿…éœ€)
    prompt: String,              // ä¸‹ä¸€ä¸ªç”¨æˆ·æç¤º
    conversation_id: Option<String>,  // å·²å¼ƒç”¨ï¼Œä½¿ç”¨ threadId
}
```

### MCP äº‹ä»¶ç±»å‹

| äº‹ä»¶ | è¯´æ˜ |
|------|------|
| McpStartupStatus | å¯åŠ¨çŠ¶æ€ |
| McpStartupUpdate | å¯åŠ¨æ›´æ–° |
| McpToolCallBegin | å·¥å…·è°ƒç”¨å¼€å§‹ |
| McpToolCallEnd | å·¥å…·è°ƒç”¨ç»“æŸ |
| McpToolCallError | å·¥å…·è°ƒç”¨é”™è¯¯ |
| McpListToolsResponse | å·¥å…·åˆ—è¡¨å“åº” |
| McpStartupComplete | å¯åŠ¨å®Œæˆ |
| McpServerRefreshConfig | æœåŠ¡å™¨é…ç½®åˆ·æ–° |

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **ç‹¬ç«‹æœåŠ¡å™¨** - codex_mcp_server æ¨¡å—
2. **äº‹ä»¶é©±åŠ¨** - å¯åŠ¨/è°ƒç”¨/é”™è¯¯äº‹ä»¶
3. **åŠ¨æ€å·¥å…·æ³¨å†Œ** - è¿è¡Œæ—¶æ‰©å±•

### ã€ä»£ç è¯æ®ã€‘MCP åè®®ç‰ˆæœ¬

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
MCP-Protocol-Version: 2024-11-05
```

### ã€ä»£ç è¯æ®ã€‘MCP è®¤è¯çŠ¶æ€

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| notLoggedIn | æœªç™»å½• |
| bearerToken | Bearer Token è®¤è¯ |
| o_auth | OAuth è®¤è¯ |

### MCP CLI å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `codex mcp add <NAME> --url <URL>` | æ·»åŠ  HTTP MCP æœåŠ¡å™¨ |
| `codex mcp add <NAME> -- <COMMAND>` | æ·»åŠ  stdio MCP æœåŠ¡å™¨ |
| `codex mcp login <NAME>` | OAuth ç™»å½• |
| `codex mcp logout <NAME>` | OAuth ç™»å‡º |
| `codex mcp remove <NAME>` | ç§»é™¤æœåŠ¡å™¨é…ç½® |

---

## 9. OAuth è®¤è¯æµç¨‹

Codex App æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼šChatGPT OAuthã€API Key å’Œ MCP OAuthã€‚

### ã€ä»£ç è¯æ®ã€‘OAuth ç«¯ç‚¹é…ç½®

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
https://auth.openai.com                    # OAuth åŸºç¡€ URL
https://auth.openai.com/oauth/token        # Token ç«¯ç‚¹
https://api.openai.com/auth                # API è®¤è¯ç«¯ç‚¹
https://api.openai.com/profile             # ç”¨æˆ·é…ç½®æ–‡ä»¶ç«¯ç‚¹
```

### ã€ä»£ç è¯æ®ã€‘è®¤è¯å­˜å‚¨ç»“æ„

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```rust
// è®¤è¯å­˜å‚¨æ–¹å¼
enum AuthStorage {
    AutoAuthStorage,      // è‡ªåŠ¨é€‰æ‹©
    KeyringStorage,       // ç³»ç»Ÿé’¥åŒ™ä¸²
    FileAuthStorage,      // æ–‡ä»¶å­˜å‚¨
}

// Token æ•°æ®ç»“æ„
struct TokenData {
    // 4 ä¸ªå­—æ®µ
}

// è®¤è¯å£°æ˜
struct AuthClaims {
    chatgpt_account_id: String,
    // ...
}
```

### è®¤è¯æ–¹å¼

| æ–¹å¼ | è¯´æ˜ |
|------|------|
| ChatGPT OAuth | Token ç”± Codex æŒä¹…åŒ–å’Œåˆ·æ–° |
| API Key | ç”±è°ƒç”¨è€…æä¾›ï¼ŒCodex å­˜å‚¨ |

### CLI ç™»å½•å‘½ä»¤

```bash
codex login [OPTIONS]
  --with-api-key     # ä» stdin è¯»å– API Key
  --device-auth      # ä½¿ç”¨è®¾å¤‡æˆæƒæµç¨‹
  --issuer-base-url  # è‡ªå®šä¹‰ OAuth issuer
  --client-id        # è‡ªå®šä¹‰ OAuth client ID
```

### ã€ä»£ç è¯æ®ã€‘è®¤è¯ç›¸å…³ç¯å¢ƒå˜é‡

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

| ç¯å¢ƒå˜é‡ | è¯´æ˜ |
|----------|------|
| CODEX_API_KEY | Codex API Key |
| OPENAI_API_KEY | OpenAI API Key |
| CODEX_REFRESH_TOKEN_URL_OVERRIDE | Token åˆ·æ–° URL è¦†ç›– |
| CODEX_CONNECTORS_TOKEN | è¿æ¥å™¨ Token |

### MCP OAuth

```bash
codex mcp login <NAME> [--scopes SCOPE,SCOPE]
codex mcp logout <NAME>
```

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **å¤šè®¤è¯æ–¹å¼** - ChatGPT OAuth / API Key
2. **Token æŒä¹…åŒ–** - æœ¬åœ°å­˜å‚¨å’Œåˆ·æ–°
3. **è®¾å¤‡æˆæƒ** - æ”¯æŒ device code æµç¨‹

---

## 10. Sentry ç›‘æ§é›†æˆ

Codex App ä½¿ç”¨ Sentry è¿›è¡Œé”™è¯¯ç›‘æ§å’Œæ€§èƒ½è¿½è¸ªã€‚

### ã€ä»£ç è¯æ®ã€‘Sentry DSN é…ç½®

**æ¥æº**: `main-BLcwFbOH.js:20451`

```javascript
// Sentry DSN - ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
const WE = "https://17de4aef18bcd467f0a250b004f16737@o33249.ingest.us.sentry.io/4510507758977024";

// ç‰ˆæœ¬æ ‡è¯†å‰ç¼€
const nq = "codex-desktop@";
```

### ã€ä»£ç è¯æ®ã€‘Envelope æ„å»ºé€»è¾‘

**æ¥æº**: `main-BLcwFbOH.js:35349-35529`

```javascript
const l0 = "application/x-sentry-envelope";
const c5 = "application/gzip";

// Envelope URL æ„å»º
function m5(t) {
  const e = new URL(t),
    r = e.pathname.split("/").filter(Boolean).at(-1);
  if (r == null || r.length === 0)
    throw new Error("Sentry DSN is missing a project id");
  return `${e.protocol}//${e.host}/api/${r}/envelope/`;
}

// Envelope æ•°æ®åºåˆ—åŒ–
function ru(t) {
  return Buffer.from(`${JSON.stringify(t)}\n`, "utf8");
}

// Envelope æ„å»º (åŒ…å« event_id, sent_at, dsn)
Buffer.concat([
  ru({ event_id: r, sent_at: m, dsn: WE }),
  ru({ type: "event" }),
  ru(y),  // äº‹ä»¶æ•°æ®
  ru(I),  // é™„ä»¶å…ƒæ•°æ®
  o,      // é™„ä»¶å†…å®¹
  p5,     // æ¢è¡Œç¬¦
]);
```

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **DSN é…ç½®** - ç¡¬ç¼–ç  Sentry é¡¹ç›®
2. **Envelope æ ¼å¼** - æ ‡å‡† Sentry åè®®
3. **Gzip å‹ç¼©** - å‡å°‘ä¸ŠæŠ¥æ•°æ®é‡

### ã€ä»£ç è¯æ®ã€‘Sentry IPC é€šé“

**æ¥æº**: `main-BLcwFbOH.js:36949-36951`

```javascript
// Sentry ç›¸å…³ IPC é€šé“
g7 = "codex_desktop:get-sentry-init-options";  // è·å–åˆå§‹åŒ–é€‰é¡¹
_7 = "codex_desktop:trigger-sentry-test";       // è§¦å‘æµ‹è¯•é”™è¯¯
```

---

## 11. Sparkle è‡ªåŠ¨æ›´æ–°

Codex App ä½¿ç”¨ Sparkle æ¡†æ¶å®ç° macOS è‡ªåŠ¨æ›´æ–°ã€‚

### ã€ä»£ç è¯æ®ã€‘Sparkle ç®¡ç†å™¨ç±»

**æ¥æº**: `main-BLcwFbOH.js:59511-59565`

```javascript
const Tt = ht("sparkle"),
  NO = 15;  // æ£€æŸ¥é—´éš”ç›¸å…³å¸¸é‡

class Fce {
  constructor(e) {
    this.options = e;
  }
  sparkleUpdater = null;
  sparkleDiagnostics = null;
  nativeAddon = null;
  isUpdateReady = !1;

  async initialize() {
    if (!this.options.enableSparkle) {
      const e = process.platform !== "darwin"
        ? "non-darwin platform"
        : `disabled for build flavor (${this.options.buildFlavor})`;
      this.sparkleDiagnostics = { reason: e, addonError: null, candidates: [] };
      return;
    }
    // åˆå§‹åŒ– Sparkle æ›´æ–°å™¨
    const { updater: e } = await this.initSparkleUpdater();
    this.sparkleUpdater = e;
  }

  getUpdater() { return this.sparkleUpdater; }
  getIsUpdateReady() { return this.isUpdateReady; }
}
```

### ã€ä»£ç è¯æ®ã€‘IPC é›†æˆ

**æ¥æº**: `main-BLcwFbOH.js`

```javascript
// æ£€æŸ¥æ›´æ–° IPC é€šé“
L.ipcMain.handle("codex_desktop:check-for-updates", async (l) => {
  this.options.isTrustedIpcEvent(l) && s();
});
```

### Appcast URL

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
https://persistent.oaistatic.com/codex-app-prod/appcast.xml
https://persistent.oaistatic.com/codex-app-prod/Codex.dmg
```

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **åŸç”Ÿæ¨¡å—** - sparkle.node åŸç”Ÿç»‘å®š
2. **åå°æ£€æŸ¥** - checkForUpdatesInBackground
3. **å®šæ—¶è½®è¯¢** - setInterval å®šæœŸæ£€æŸ¥

---

## 12. node-pty ç»ˆç«¯æ¨¡æ‹Ÿ

Codex App ä½¿ç”¨ node-pty å®ç°ä¼ªç»ˆç«¯æ¨¡æ‹Ÿã€‚

### ã€ä»£ç è¯æ®ã€‘PTY åˆ›å»ºå®Œæ•´æµç¨‹

**æ¥æº**: `main-BLcwFbOH.js:64475-64507`

```javascript
// Shell è§£æ
const o = this.resolveShell(),
  s = this.terminalCommand && this.terminalCommand.length > 0
    ? this.terminalCommand
    : [o],
  [c, ...u] = s,
  l = this.buildTerminalEnv();

// åŠ¨æ€å¯¼å…¥ node-pty
const { spawn: p } = await import("node-pty"),
  d = p(c, u, {
    cols: n.cols ?? 80,   // é»˜è®¤ 80 åˆ—
    rows: n.rows ?? 24,   // é»˜è®¤ 24 è¡Œ
    cwd: a,
    env: l
  });
```

### ã€ä»£ç è¯æ®ã€‘ä¼šè¯æ•°æ®ç»“æ„

**æ¥æº**: `main-BLcwFbOH.js:64486-64497`

```javascript
const m = {
  id: r,
  pty: d,
  owner: e,
  ownerId: e.id,
  buffer: "",
  cwd: i,
  shell: f,
  attached: !1,
  conversationId: n.conversationId,
  preserveOnOwnerDestroy: n.preserveOnOwnerDestroy ?? !1,
};
```
  owner: e,
  buffer: "",
  cwd: i,
  shell: f,
  attached: false,
  conversationId: n.conversationId,
  preserveOnOwnerDestroy: n.preserveOnOwnerDestroy ?? false,
};
```

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **åŠ¨æ€å¯¼å…¥** - æŒ‰éœ€åŠ è½½ node-pty
2. **ä¼šè¯ç®¡ç†** - Map å­˜å‚¨ä¼šè¯
3. **Conversation å…³è”** - æ”¯æŒä¼šè¯æ¢å¤

---

## 13. Worker çº¿ç¨‹ä»»åŠ¡å¤„ç†

Codex App ä½¿ç”¨ Node.js Worker Threads å¤„ç†åå°ä»»åŠ¡ã€‚

### ã€ä»£ç è¯æ®ã€‘Worker åˆå§‹åŒ–

**æ¥æº**: `main-BLcwFbOH.js:51182, 54617`

```javascript
// Worker åˆ›å»º
const o = new a_.Worker(n, { name: this.id, workerData: a });

// Worker å…¥å£
const { workerId, sentryInitOptions, ... } = zu.workerData;
const Lh = zu.parentPort;
if (!Lh)
  throw new Error("worker-entry must be run in a worker thread");

Lh.on("message", e => { /* å¤„ç†æ¶ˆæ¯ */ });
```

### ã€ä»£ç è¯æ®ã€‘æ¶ˆæ¯ç±»å‹å¤„ç†

**æ¥æº**: `main-BLcwFbOH.js:54665-54676`

```javascript
switch (n.type) {
  case "worker-request": {
    this.pending.set(n.request.id, e);
    break;
  }
  case "worker-request-cancel": {
    this.pending.delete(n.id);
    break;
  }
}
this.workerManager.postMessage(n);
```

### æ¶ˆæ¯ç±»å‹

| ç±»å‹ | è¯´æ˜ |
|------|------|
| worker-sentry-user-update | æ›´æ–° Sentry ç”¨æˆ·ä¿¡æ¯ |
| worker-app-event | åº”ç”¨äº‹ä»¶ |
| worker-request | å·¥ä½œè¯·æ±‚ |
| worker-request-cancel | å–æ¶ˆè¯·æ±‚ |

### Git å¤„ç†å™¨æ–¹æ³•

- stable-metadata
- current-branch
- create-worktree
- delete-worktree

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **parentPort é€šä¿¡** - ä¸»è¿›ç¨‹æ¶ˆæ¯ä¼ é€’
2. **è¯·æ±‚/å“åº”æ¨¡å¼** - worker-request/worker-response
3. **Git æ“ä½œ** - ç‹¬ç«‹ Worker å¤„ç†

---

## 14. Cloud Tasks äº‘ç«¯ä»»åŠ¡

Cloud Tasks æ˜¯å®éªŒæ€§åŠŸèƒ½ï¼Œå…è®¸åœ¨äº‘ç«¯æ‰§è¡Œä»»åŠ¡ã€‚

### ã€ä»£ç è¯æ®ã€‘ç¯å¢ƒå˜é‡

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
CODEX_CLOUD_TASKS_MODE
CODEX_CLOUD_TASKS_BASE_URL
CODEX_CLOUD_TASKS_FORCE_INTERNAL
```

### ã€ä»£ç è¯æ®ã€‘CLI å‘½ä»¤

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```bash
codex cloud          # æµè§ˆäº‘ç«¯ä»»åŠ¡ TUI
codex cloud exec     # æäº¤æ–°ä»»åŠ¡
codex cloud list     # åˆ—å‡ºä»»åŠ¡
codex cloud status   # æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
codex cloud diff     # æŸ¥çœ‹ä»»åŠ¡ diff
codex cloud apply    # åº”ç”¨ä»»åŠ¡ diff
```

**æ ¸å¿ƒè®¾è®¡ï¼š**
1. **å®éªŒæ€§åŠŸèƒ½** - [EXPERIMENTAL] æ ‡è®°
2. **TUI ç•Œé¢** - ç»ˆç«¯äº¤äº’å¼ç•Œé¢
3. **Diff åº”ç”¨** - æœ¬åœ°åº”ç”¨äº‘ç«¯ç»“æœ

### ã€ä»£ç è¯æ®ã€‘æºç æ¨¡å—ç»“æ„

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
cloud-tasks/src/lib.rs
cloud-tasks/src/env_detect.rs
cloud-tasks/src/commands/exec.rs
cloud-tasks/src/commands/list.rs
cloud-tasks/src/commands/status.rs
cloud-tasks/src/commands/diff.rs
cloud-tasks/src/commands/apply.rs
cloud-tasks/src/tui.rs
```

### ã€ä»£ç è¯æ®ã€‘å‘½ä»¤ç»“æ„å®šä¹‰

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```rust
// CLI å‘½ä»¤ç»“æ„
ExecCommand      // æ‰§è¡Œäº‘ç«¯ä»»åŠ¡
ListCommand      // åˆ—å‡ºä»»åŠ¡
ApplyCommand     // åº”ç”¨ diff
StatusCommand    // æŸ¥çœ‹çŠ¶æ€
DiffCommand      // æŸ¥çœ‹ diff

// ç¯å¢ƒæ£€æµ‹
CodeEnvironment  // ä»£ç ç¯å¢ƒç»“æ„
```

---

## 15. æ¶æ„æ€»ç»“

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Codex Desktop App                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Main      â”‚  â”‚   Renderer  â”‚  â”‚   Worker    â”‚     â”‚
â”‚  â”‚   Process   â”‚â—„â”€â”¤   Process   â”‚  â”‚   Thread    â”‚     â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚     â”‚
â”‚  â”‚ - IPC       â”‚  â”‚ - React UI  â”‚  â”‚ - Git Ops   â”‚     â”‚
â”‚  â”‚ - SQLite    â”‚  â”‚ - WebView   â”‚  â”‚ - File Ops  â”‚     â”‚
â”‚  â”‚ - Sparkle   â”‚  â”‚             â”‚  â”‚             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                                               â”‚
â”‚         â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Codex CLI (Rust)                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚  Core   â”‚ â”‚   MCP   â”‚ â”‚  Cloud  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚         â”‚ â”‚  Server â”‚ â”‚  Tasks  â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—ä¾èµ–

**Electron å±‚**
```
Main Process
â”œâ”€â”€ IPC Router (codex_desktop:*)
â”œâ”€â”€ SQLite DAL (better-sqlite3)
â”œâ”€â”€ Sparkle Updater
â””â”€â”€ Worker Thread Manager

Renderer Process
â”œâ”€â”€ React UI
â””â”€â”€ electronBridge API
```

**Rust CLI å±‚**
```
codex_core
â”œâ”€â”€ auth (è®¤è¯)
â”œâ”€â”€ exec (æ‰§è¡Œ)
â””â”€â”€ mcp_connection_manager

codex_app_server
â”œâ”€â”€ message_processor
â”œâ”€â”€ dynamic_tools
â””â”€â”€ transport
```

---

## 16. æ¶æ„æ·±åº¦åˆ†æ

### è¿›ç¨‹é€šä¿¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     IPC      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Main      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Renderer   â”‚
â”‚   Process   â”‚              â”‚   Process   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Worker Threads
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Worker    â”‚
â”‚   (Git)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Child Process
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Codex CLI  â”‚
â”‚   (Rust)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµæ¶æ„

**ç”¨æˆ·è¾“å…¥æµ**
```
User Input â†’ Renderer (React) â†’ Main Process â†’ Codex CLI â†’ OpenAI API
```

**AI å“åº”æµ**
```
OpenAI API (SSE) â†’ Codex CLI â†’ Main Process â†’ Renderer â†’ UI Update
```

### çŠ¶æ€ç®¡ç†æ¶æ„

**æŒä¹…åŒ–çŠ¶æ€ (SQLite)**
```
â”œâ”€â”€ automations      # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ automation_runs  # æ‰§è¡Œè®°å½•
â””â”€â”€ inbox_items      # æ”¶ä»¶ç®±
```

**è¿è¡Œæ—¶çŠ¶æ€**
```
Main Process Memory
â”œâ”€â”€ Thread Sessions  # æ´»è·ƒçº¿ç¨‹
â”œâ”€â”€ PTY Sessions     # ç»ˆç«¯ä¼šè¯
â””â”€â”€ Worker Refs      # Worker å¼•ç”¨
```

### æ‰©å±•æ¶æ„

**Skills æ‰©å±•ç‚¹**
```
~/.codex/skills/
â””â”€â”€ <skill-name>/
    â”œâ”€â”€ SKILL.md       # å…ƒæ•°æ®
    â””â”€â”€ agents/
        â””â”€â”€ openai.yaml # Agent é…ç½®
```

**MCP æ‰©å±•ç‚¹**
```
MCP Server Registry
â”œâ”€â”€ Built-in Tools
â”œâ”€â”€ Dynamic Tools (runtime)
â””â”€â”€ External MCP Servers
```

### éš”ç¦»æ¶æ„

**è¿›ç¨‹éš”ç¦»**
```
Electron Sandbox
â”œâ”€â”€ contextIsolation: true
â””â”€â”€ nodeIntegration: false
```

**æ–‡ä»¶ç³»ç»Ÿéš”ç¦»**
```
macOS: Seatbelt (sandbox-exec)
Linux: Landlock + seccomp
Windows: Restricted Token
```

**Git Worktree éš”ç¦»**
- æ¯ä¸ª Thread ç‹¬ç«‹ Worktree
- é¿å…å·¥ä½œç›®å½•å†²çª
- æ”¯æŒå¹¶è¡Œä»»åŠ¡

### æ¶æ„è®¾è®¡åŸåˆ™

| å±‚ | èŒè´£ |
|---|---|
| UI | React æ¸²æŸ“ |
| IPC | æ¶ˆæ¯è·¯ç”± |
| Business | Main Process |
| Compute | Worker/CLI |

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

- Worker Thread å¤„ç† Git æ“ä½œ
- Rust CLI å¤„ç† AI äº¤äº’
- åŠ¨æ€å¯¼å…¥ (node-pty)
- æ¶ˆæ¯æ‰¹å¤„ç†

---

### æ€»ç»“

#### æ ¸å¿ƒæ¶æ„ç‰¹ç‚¹

1. **æ··åˆæŠ€æœ¯æ ˆ** - Electron + Rust
2. **å¤šè¿›ç¨‹æ¨¡å‹** - Main/Renderer/Worker
3. **æ’ä»¶åŒ–è®¾è®¡** - Skills + MCP
4. **æ²™ç®±éš”ç¦»** - å¤šå±‚å®‰å…¨æœºåˆ¶

#### å¯å€Ÿé‰´ç‚¹

- Worker åˆ†ç¦»è€—æ—¶æ“ä½œ
- Rust å¤„ç†æ€§èƒ½æ•æ„Ÿé€»è¾‘
- Git Worktree å®ç°ä»»åŠ¡éš”ç¦»
- ç‰ˆæœ¬åŒ–æ•°æ®åº“è¿ç§»

---

## 17. å®‰å…¨æœºåˆ¶æ·±åº¦åˆ†æ

### ã€ä»£ç è¯æ®ã€‘æ²™ç®±æºç æ¨¡å—

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
core/src/sandboxing/mod.rs
core/src/seatbelt.rs
core/src/landlock.rs
cli/src/debug_sandbox/seatbelt.rs
cli/src/debug_sandbox/pid_tracker.rs
```

### æ²™ç®±æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ | é£é™©ç­‰çº§ |
|------|------|----------|
| read-only | åªè¯»æ¨¡å¼ï¼Œç¦æ­¢å†™å…¥ | ä½ |
| workspace-write | å…è®¸å†™å…¥å·¥ä½œç›®å½• | ä¸­ |
| danger-full-access | å®Œå…¨è®¿é—®ï¼Œæ— é™åˆ¶ | é«˜ |

### å®¡æ‰¹ç­–ç•¥

| ç­–ç•¥ | è¯´æ˜ |
|------|------|
| on-request | æ¯æ¬¡æ‰§è¡Œå‰è¯·æ±‚ç”¨æˆ·ç¡®è®¤ |
| never | ä»ä¸è¯·æ±‚ç¡®è®¤ï¼ˆå±é™©ï¼‰ |

### ã€ä»£ç è¯æ®ã€‘æ²™ç®±CLIå‘½ä»¤

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```rust
// è°ƒè¯•æ²™ç®±å‘½ä»¤
SeatbeltCommand     // macOS Seatbelt æ²™ç®±å‘½ä»¤
LandlockCommand     // Linux Landlock æ²™ç®±å‘½ä»¤
WindowsCommand      // Windows å—é™ä»¤ç‰Œå‘½ä»¤

// å‘½ä»¤è¡Œå‚æ•°
--sandbox-policy    // æ²™ç®±ç­–ç•¥å‚æ•°
log_denials         // è®°å½•æ‹’ç»æ—¥å¿—
LOG_DENIALS         // ç¯å¢ƒå˜é‡
```

### è·¨å¹³å°æ²™ç®±å®ç°

| å¹³å° | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| macOS | Seatbelt | /usr/bin/sandbox-exec |
| Linux | Landlock + seccomp | æ–‡ä»¶ç³»ç»Ÿéš”ç¦» + ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ |
| Windows | Restricted Token | å—é™ä»¤ç‰Œ |

### ã€ä»£ç è¯æ®ã€‘Seatbelt ç­–ç•¥è§„åˆ™

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```scheme
; åŸºç¡€ç­–ç•¥æ–‡ä»¶: seatbelt_base_policy.sbpl
(allow file-read*)              ; åªè¯»æ–‡ä»¶æ“ä½œ
(allow network-outbound)        ; ç½‘ç»œå‡ºç«™ (å½“ network_access å¯ç”¨æ—¶)
(allow process-exec)            ; è¿›ç¨‹æ‰§è¡Œ
(allow process-fork)            ; è¿›ç¨‹åˆ†å‰

; PTY æ‰©å±• (PTYs created before entering seatbelt may lack the extension)
(allow ioctl)                   ; å…è®¸ ioctl æ“ä½œ
```

### ã€ä»£ç è¯æ®ã€‘æ²™ç®±æ—¥å¿—ç›‘æ§

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```rust
// macOS æ²™ç®±æ‹’ç»æ—¥å¿—æ•è·
// æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ²™ç®±æ‹’ç»äº‹ä»¶
^Sandbox:\s*(.+?)\((\d+)\)\s+deny\(.*?\)\s*(.+)$

// log stream è°“è¯
(((processID == 0) AND (senderImagePath CONTAINS "/Sandbox"))
 OR (subsystem == "com.apple.sandbox.reporting"))
```

---

## 18. App Server Protocol åè®®åˆ†æ

### ã€ä»£ç è¯æ®ã€‘ClientRequest ç±»å‹åˆ—è¡¨

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```typescript
// Thread æ“ä½œ
ThreadStartParams, ThreadListParams, ThreadReadParams
ThreadForkParams, ThreadArchiveParams, ThreadUnarchiveParams
ThreadSetNameParams, ThreadRollbackParams, ThreadResumeParams
ThreadCompactStartParams, ThreadLoadedListParams

// Turn æ“ä½œ
TurnStartParams, TurnSteerParams, TurnInterruptParams
SendUserMessageParams, SendUserTurnParams

// è®¤è¯æ“ä½œ
LoginAccountParams, LoginApiKeyParams, GetAccountParams
GetAuthStatusParams, CancelLoginAccountParams, CancelLoginChatGptParams

// é…ç½®æ“ä½œ
ConfigReadParams, ConfigValueWriteParams, ConfigBatchWriteParams
InitializeParams, SetDefaultModelParams
```

### åè®®ç‰ˆæœ¬

| ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|
| v1 | æ—§ç‰ˆåè®® |
| v2 | æ–°ç‰ˆåè®®ï¼Œæ”¯æŒåŠ¨æ€å·¥å…· |

### ç”Ÿå‘½å‘¨æœŸäº‹ä»¶

**Thread äº‹ä»¶**
- thread/started, thread/name/updated, thread/tokenUsage/updated

**Turn äº‹ä»¶**
- turn/started, turn/completed, turn/diff/updated

**Item äº‹ä»¶**
- item/started, item/completed, item/agentMessage/delta

### ã€ä»£ç è¯æ®ã€‘ServerNotification äº‹ä»¶ç±»å‹

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```typescript
// Thread äº‹ä»¶
ThreadNameUpdatedEvent, ThreadRolledBackEvent, ContextCompactedEvent

// Turn äº‹ä»¶
TurnStartedEvent, TurnCompleteEvent, TurnAbortedEvent, TurnDiffEvent

// Agent æ¶ˆæ¯äº‹ä»¶
AgentMessageEvent, AgentMessageDeltaEvent
AgentReasoningEvent, AgentReasoningDeltaEvent

// å‘½ä»¤æ‰§è¡Œäº‹ä»¶
ExecCommandBeginEvent, ExecCommandEndEvent, ExecApprovalRequestEvent

// åä½œ Agent äº‹ä»¶
CollabAgentSpawnBeginEvent, CollabAgentSpawnEndEvent
CollabWaitingBeginEvent, CollabWaitingEndEvent
CollabCloseBeginEvent, CollabCloseEndEvent

// å…¶ä»–äº‹ä»¶
ErrorEvent, StreamErrorEvent, WarningEvent
SessionConfiguredEvent, TokenCountEvent
WebSearchBeginEvent, WebSearchEndEvent
UndoStartedEvent, UndoCompletedEvent
```

### ä¼ è¾“å±‚

| ç±»å‹ | è¯´æ˜ |
|------|------|
| WebSocket | å®æ—¶åŒå‘é€šä¿¡ |
| stdio | CLI è¿›ç¨‹é€šä¿¡ |
| SSE | AI å“åº”æµ |

---

## 19. å·¥å…·ç³»ç»Ÿåˆ†æ

### ã€ä»£ç è¯æ®ã€‘å†…ç½®å·¥å…·åˆ—è¡¨

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
list_dir        # åˆ—å‡ºç›®å½•
read_file       # è¯»å–æ–‡ä»¶
grep_files      # æœç´¢æ–‡ä»¶
apply_patch     # åº”ç”¨è¡¥ä¸
shell           # Shell å‘½ä»¤
web_search      # ç½‘ç»œæœç´¢
view_image      # æŸ¥çœ‹å›¾ç‰‡
```

### å†…ç½®å·¥å…·

| å·¥å…· | è¯´æ˜ |
|------|------|
| list_dir | åˆ—å‡ºç›®å½• |
| read_file | è¯»å–æ–‡ä»¶ |
| grep_files | æœç´¢æ–‡ä»¶ |
| apply_patch | åº”ç”¨è¡¥ä¸ |
| shell | Shell å‘½ä»¤ |
| web_search | ç½‘ç»œæœç´¢ |
| view_image | æŸ¥çœ‹å›¾ç‰‡ |

### ã€ä»£ç è¯æ®ã€‘apply_patch æ ¼å¼

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
Usage: apply_patch 'PATCH'
       echo 'PATCH' | apply_patch

The first line of the patch must be '*** Begin Patch'
The last line of the patch must be '*** End Patch'
```

### ã€ä»£ç è¯æ®ã€‘å·¥å…·é…ç½®å‚æ•°

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```toml
tool_timeout_sec          # å·¥å…·è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
tool_output_token_limit   # å·¥å…·è¾“å‡º token é™åˆ¶
```

---

## 20. é…ç½®ç³»ç»Ÿåˆ†æ

### ã€ä»£ç è¯æ®ã€‘ç¯å¢ƒå˜é‡åˆ—è¡¨

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
CODEX_HOME                    # Codex ä¸»ç›®å½•
CODEX_API_KEY                 # API å¯†é’¥
CODEX_CI                      # CI æ¨¡å¼æ ‡å¿—
CODEX_SANDBOX                 # æ²™ç®±è·¯å¾„
CODEX_SANDBOX_NETWORK_DISABLED # ç¦ç”¨ç½‘ç»œæ²™ç®±
CODEX_THREAD_ID               # çº¿ç¨‹ ID
CODEX_STARTING_DIFF           # èµ·å§‹ diff
CODEX_GITHUB_PERSONAL_ACCESS_TOKEN # GitHub PAT
CODEX_CLOUD_TASKS_MODE        # äº‘ä»»åŠ¡æ¨¡å¼
CODEX_CLOUD_TASKS_BASE_URL    # äº‘ä»»åŠ¡ API URL
CODEX_OSS_BASE_URL            # OSS åŸºç¡€ URL
CODEX_OSS_PORT                # OSS ç«¯å£
```

### é…ç½®æ–‡ä»¶

```
~/.codex/config.toml
```

### æ ¸å¿ƒé…ç½®é¡¹

```toml
[model]
model_provider = "openai"
model_context_window = 128000

[sandbox_workspace_write]
writable_roots = []
network_access = false

[tools]
web_search = "live"
tool_timeout_secs = 300
```

### ã€ä»£ç è¯æ®ã€‘é…ç½®å±‚çº§æ¥æº

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```typescript
// é…ç½®å±‚çº§ç±»å‹
type ConfigLayerSource =
  | "mdm"                           // MDM ç®¡ç†é…ç½® (macOS)
  | "system"                        // ç³»ç»Ÿé…ç½®
  | "user"                          // ç”¨æˆ·é…ç½® (~/.codex/config.toml)
  | "project"                       // é¡¹ç›®é…ç½® (.codex/)
  | "sessionFlags"                  // ä¼šè¯æ ‡å¿— (-c/--config)
  | "legacyManagedConfigTomlFromFile"  // æ—§ç‰ˆæ‰˜ç®¡é…ç½®
  | "legacyManagedConfigTomlFromMdm"   // æ—§ç‰ˆ MDM é…ç½®
```

### é…ç½®å±‚çº§ä¼˜å…ˆçº§

```
1. å‘½ä»¤è¡Œå‚æ•° (æœ€é«˜)
2. ç¯å¢ƒå˜é‡
3. é¡¹ç›®é…ç½® (.codex/)
4. ç”¨æˆ·é…ç½® (~/.codex/config.toml)
5. é»˜è®¤å€¼ (æœ€ä½)
```

---

## 21. Prompt å·¥ç¨‹åˆ†æ

Codex App ä½¿ç”¨ç²¾å¿ƒè®¾è®¡çš„æç¤ºè¯ç³»ç»Ÿæ¥æŒ‡å¯¼ AI Agent çš„è¡Œä¸ºã€‚

### ã€ä»£ç è¯æ®ã€‘AGENTS.md è§„èŒƒ

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```markdown
# AGENTS.md spec
- Repos often contain AGENTS.md files. These files can appear anywhere within the repository.
- Instructions in AGENTS.md files:
    - The scope of an AGENTS.md file is the entire directory tree rooted at the folder that contains it.
    - For every file you touch in the final patch, you must obey instructions in any AGENTS.md file whose scope includes that file.
    - Instructions about code style, structure, naming, etc. apply only to code within the AGENTS.md file's scope, unless the file states otherwise.
    - More-deeply-nested AGENTS.md files take precedence in the case of conflicting instructions.
    - Direct system/developer/user instructions (as part of a prompt) take precedence over AGENTS.md instructions.
```

### AGENTS.md è§„èŒƒ

**ä½œç”¨åŸŸè§„åˆ™**
- AGENTS.md æ–‡ä»¶å¯ä»¥å‡ºç°åœ¨ä»“åº“çš„ä»»ä½•ä½ç½®
- ä½œç”¨åŸŸä¸ºåŒ…å«è¯¥æ–‡ä»¶çš„ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•
- æ·±å±‚åµŒå¥—çš„ AGENTS.md ä¼˜å…ˆçº§æ›´é«˜
- ç³»ç»Ÿ/å¼€å‘è€…/ç”¨æˆ·ç›´æ¥æŒ‡ä»¤ä¼˜å…ˆçº§æœ€é«˜

**ä¼˜å…ˆçº§å±‚æ¬¡**

| ä¼˜å…ˆçº§ | æ¥æº |
|--------|------|
| 1 (æœ€é«˜) | ç³»ç»Ÿ/å¼€å‘è€…/ç”¨æˆ·ç›´æ¥æŒ‡ä»¤ |
| 2 | æ·±å±‚åµŒå¥—çš„ AGENTS.md |
| 3 | æµ…å±‚åµŒå¥—çš„ AGENTS.md |
| 4 (æœ€ä½) | æ ¹ç›®å½• AGENTS.md |

### ã€ä»£ç è¯æ®ã€‘æ¨ç†é…ç½®é€‰é¡¹

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```typescript
// Turn å¯åŠ¨å‚æ•°ä¸­çš„æ¨ç†é…ç½®
reasoning_effort           // æ¨ç†åŠªåŠ›ç¨‹åº¦
reasoning_summary          // æ¨ç†æ‘˜è¦
reasoning_summary_format   // æ¨ç†æ‘˜è¦æ ¼å¼: "experimental" | "none"

// æ¨ç†é…ç½®è¦†ç›–
"Override the reasoning effort for this turn and subsequent turns."
"Override the reasoning summary for this turn and subsequent turns."
```

### æŒ‡ä»¤ç±»å‹

| ç±»å‹ | è¯´æ˜ |
|------|------|
| baseInstructions | åŸºç¡€ç³»ç»ŸæŒ‡ä»¤ |
| developerInstructions | å¼€å‘è€…è‡ªå®šä¹‰æŒ‡ä»¤ |
| personality | ä¸ªæ€§åŒ–é…ç½® |
| customPrompt | è‡ªå®šä¹‰æç¤ºè¯ |

### apply_patch å·¥å…·æ ¼å¼

**è¡¥ä¸æ ¼å¼**
```
*** Begin Patch
*** Update File: path/to/file.py
@@ def example():
- pass
+ return 123
*** End Patch
```

**æ–‡ä»¶æ“ä½œç±»å‹**

| æ“ä½œ | è¯­æ³• | è¯´æ˜ |
|------|------|------|
| Add File | `*** Add File: <path>` | åˆ›å»ºæ–°æ–‡ä»¶ |
| Delete File | `*** Delete File: <path>` | åˆ é™¤æ–‡ä»¶ |
| Update File | `*** Update File: <path>` | æ›´æ–°ç°æœ‰æ–‡ä»¶ |

### æ¨ç†é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| reasoning_effort | æ¨ç†åŠªåŠ›çº§åˆ« (low/medium/high) |
| reasoning_summary | æ˜¯å¦ç”Ÿæˆæ¨ç†æ‘˜è¦ |

### æç¤ºè¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç³»ç»ŸåŸºç¡€æŒ‡ä»¤                    â”‚
â”‚         (baseInstructions)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           å¼€å‘è€…æŒ‡ä»¤                      â”‚
â”‚       (developerInstructions)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           AGENTS.md æŒ‡ä»¤                 â”‚
â”‚      (æŒ‰ç›®å½•æ·±åº¦ä¼˜å…ˆçº§æ’åº)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ç”¨æˆ·æ¶ˆæ¯                        â”‚
â”‚         (User Messages)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 22. é”™è¯¯å¤„ç†æœºåˆ¶åˆ†æ

Codex App å®ç°äº†å®Œæ•´çš„é”™è¯¯å¤„ç†ä½“ç³»ã€‚

### ã€ä»£ç è¯æ®ã€‘é”™è¯¯ä¿¡æ¯ç»“æ„

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```rust
codex_error_info      // é”™è¯¯ä¿¡æ¯è½½ä½“
http_status_code      // HTTP çŠ¶æ€ç 
user_facing_hint      // ç”¨æˆ·æç¤ºä¿¡æ¯
```

### ã€ä»£ç è¯æ®ã€‘é”™è¯¯æ¶ˆæ¯åˆ—è¡¨

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```
Error: apply_patch accepts exactly one argument.
Error: apply_patch requires a UTF-8 PATCH argument.
Error listing threads:
Error finding codex home:
Error parsing -c overrides:
Error loading config.toml:
error deriving config:
error forking thread:
error creating thread:
error resuming thread:
aborted by user
```

### é”™è¯¯äº‹ä»¶ç±»å‹

| äº‹ä»¶ | è¯´æ˜ |
|------|------|
| StreamErrorEvent | æµé”™è¯¯äº‹ä»¶ |
| ErrorEvent | é€šç”¨é”™è¯¯äº‹ä»¶ |
| ErrorNotification | é”™è¯¯é€šçŸ¥ |
| McpToolCallError | MCP å·¥å…·è°ƒç”¨é”™è¯¯ |

### é”™è¯¯åˆ†ç±»

**ç½‘ç»œé”™è¯¯**
- websocket closed - WebSocket è¿æ¥å…³é—­
- empty sse stream - SSE æµä¸ºç©º
- ConnectionClosed - è¿æ¥å·²å…³é—­

**API é”™è¯¯**
- Invalid request - æ— æ•ˆè¯·æ±‚
- rate limit - é€Ÿç‡é™åˆ¶
- authentication required - éœ€è¦è®¤è¯

**æ‰§è¡Œé”™è¯¯**
- operation not permitted - æ“ä½œä¸å…è®¸
- read-only file system - åªè¯»æ–‡ä»¶ç³»ç»Ÿ
- timeout - è¶…æ—¶

---

## 23. çŠ¶æ€æœºåˆ†æ

Codex App ä½¿ç”¨çŠ¶æ€æœºç®¡ç† Thread å’Œ Turn çš„ç”Ÿå‘½å‘¨æœŸã€‚

### ã€ä»£ç è¯æ®ã€‘ç”Ÿå‘½å‘¨æœŸäº‹ä»¶

**æ¥æº**: `codex äºŒè¿›åˆ¶ strings æå–`

```typescript
// Thread äº‹ä»¶
thread/started
thread/name/updated
thread/tokenUsage/updated

// Turn äº‹ä»¶
turn/started
turn/completed
turn/diff/updated
turn/plan/updated

// Item äº‹ä»¶
item/started
item/completed
item/agentMessage/delta
item/plan/delta
item/commandExecution/outputDelta
item/reasoning/summaryTextDelta
```

### Thread çŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| initialized | å·²åˆå§‹åŒ– |
| started | å·²å¯åŠ¨ |
| archived | å·²å½’æ¡£ |
| compacted | å·²å‹ç¼© |

### Turn çŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| started | å·²å¯åŠ¨ |
| completed | å·²å®Œæˆ |
| aborted | å·²ä¸­æ–­ |

---

## 24. æ•°æ®æµåˆ†æ

Codex App çš„æ•°æ®æµæ¶‰åŠå¤šä¸ªè¿›ç¨‹å’Œä¼ è¾“å±‚ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’ã€‚

### ç”¨æˆ·è¾“å…¥æµ

```
User Input â†’ Renderer (React) â†’ IPC â†’ Main Process â†’ CLI â†’ OpenAI API
```

### AI å“åº”æµ

```
OpenAI API (SSE) â†’ CLI â†’ Main Process â†’ IPC â†’ Renderer â†’ UI Update
```

### ä¼ è¾“å±‚

| ç±»å‹ | è¯´æ˜ |
|------|------|
| WebSocket | å®æ—¶åŒå‘é€šä¿¡ |
| SSE | AI å“åº”æµ |
| stdio | CLI è¿›ç¨‹é€šä¿¡ |
| IPC | Electron è¿›ç¨‹é—´é€šä¿¡ |

---

## 25. é€†å‘åˆ†ææ€»ç»“æŠ¥å‘Š

æœ¬ç« æ±‡æ€»æ‰€æœ‰é€†å‘åˆ†ææˆæœï¼Œæä¾›å®Œæ•´çš„ä»£ç æ¶æ„å›¾ã€å…³é”®æŠ€æœ¯å®ç°æ€»ç»“ã€å®‰å…¨é£é™©åˆ†æå’Œæ”¹è¿›å»ºè®®ã€‚

### 25.1 é€†å‘åˆ†ææ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | å†…å®¹ | å…³é”®å‘ç° |
|------|------|----------|
| [25-main-js-reverse](deep/25-main-js-reverse.md) | ä¸»è¿›ç¨‹ JS é€†å‘ | ç±»å®šä¹‰ã€IPC å¤„ç†å™¨ã€äº‹ä»¶ç›‘å¬ |
| [26-worker-js-reverse](deep/26-worker-js-reverse.md) | Worker çº¿ç¨‹é€†å‘ | æ¶ˆæ¯å¤„ç†ã€Git æ“ä½œã€æ–‡ä»¶æ—¥å¿— |
| [27-preload-reverse](deep/27-preload-reverse.md) | Preload è„šæœ¬é€†å‘ | electronBridge APIã€å®‰å…¨é…ç½® |
| [28-cli-binary-reverse](deep/28-cli-binary-reverse.md) | CLI äºŒè¿›åˆ¶é€†å‘ | Rust æ¨¡å—ã€ç¯å¢ƒå˜é‡ã€åè®®ç±»å‹ |
| [29-sparkle-native-reverse](deep/29-sparkle-native-reverse.md) | Sparkle åŸç”Ÿæ¨¡å— | æ›´æ–°æµç¨‹ã€EdDSA ç­¾å |
| [30-pty-native-reverse](deep/30-pty-native-reverse.md) | PTY åŸç”Ÿæ¨¡å— | ç³»ç»Ÿè°ƒç”¨ã€N-API ç»‘å®š |
| [31-sqlite-native-reverse](deep/31-sqlite-native-reverse.md) | SQLite åŸç”Ÿæ¨¡å— | Database/Statement ç±» |
| [32-js-obfuscation](deep/32-js-obfuscation.md) | JS æ··æ·†åˆ†æ | Vite/Rollup/Terser å·¥å…·é“¾ |
| [33-protocol-reverse](deep/33-protocol-reverse.md) | åè®®æ¶ˆæ¯é€†å‘ | ClientRequest/ServerNotification |
| [34-seatbelt-reverse](deep/34-seatbelt-reverse.md) | Seatbelt ç­–ç•¥é€†å‘ | æ–‡ä»¶/ç½‘ç»œ/IPC æƒé™è§„åˆ™ |
| [35-dependencies](deep/35-dependencies.md) | ä¾èµ–åˆ†æ | Electron 40.0.0ã€ç‰ˆæœ¬ 260208.1016 |
| [36-renderer-entry](deep/36-renderer-entry.md) | æ¸²æŸ“è¿›ç¨‹å…¥å£ | React åˆå§‹åŒ–ã€Provider å±‚çº§ |
| [37-hardcoded-urls](deep/37-hardcoded-urls.md) | ç¡¬ç¼–ç  URL | 15 ç±» API ç«¯ç‚¹ |
| [38-electron-config](deep/38-electron-config.md) | Electron é…ç½® | BrowserWindowã€å®‰å…¨è®¾ç½® |
| [39-webview-html](deep/39-webview-html.md) | Webview HTML | CSP ç­–ç•¥ã€433 ä¸ª JS æ¨¡å— |
| [40-node-pty-source](deep/40-node-pty-source.md) | node-pty æºç  | Terminal ç±»ã€PTY fork |
| [41-environment-vars](deep/41-environment-vars.md) | ç¯å¢ƒå˜é‡ | 25+ CODEX_ å˜é‡ |
| [42-appcast-analysis](deep/42-appcast-analysis.md) | Appcast åˆ†æ | ç‰ˆæœ¬å†å²ã€Delta æ›´æ–° |
| [43-cli-commands](deep/43-cli-commands.md) | CLI å‘½ä»¤ | å­å‘½ä»¤ã€TUI æ–œæ å‘½ä»¤ |

### 25.2 å®Œæ•´ä»£ç æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Codex Desktop App                                  â”‚
â”‚                         Version: 260208.1016 (Build 571)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        Electron 40.0.0                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚   Main      â”‚  â”‚  Renderer   â”‚  â”‚   Worker    â”‚  â”‚  Preload   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Process    â”‚  â”‚  Process    â”‚  â”‚  Thread     â”‚  â”‚  Script    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ main-*.js   â”‚  â”‚ index-*.js  â”‚  â”‚ worker-*.js â”‚  â”‚ preload.js â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ (60K+ è¡Œ)   â”‚  â”‚ (React 18)  â”‚  â”‚ (Git ops)   â”‚  â”‚ (Bridge)   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚         â”‚                â”‚                â”‚               â”‚         â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚
â”‚  â”‚                          â”‚                â”‚                          â”‚    â”‚
â”‚  â”‚                    IPC (codex_desktop:*)  â”‚                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Native Modules         â”‚                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚    â”‚
â”‚  â”‚  â”‚ sparkle.nodeâ”‚  â”‚  pty.node   â”‚  â”‚better_sqliteâ”‚                   â”‚    â”‚
â”‚  â”‚  â”‚ (Sparkle)   â”‚  â”‚ (node-pty)  â”‚  â”‚  3.node     â”‚                   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Rust CLI (codex)       â”‚                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ codex_core  â”‚  â”‚ codex_exec  â”‚  â”‚ app_server  â”‚  â”‚  sandbox   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ (æ ¸å¿ƒé€»è¾‘)  â”‚  â”‚ (å‘½ä»¤æ‰§è¡Œ)  â”‚  â”‚ (åè®®æœåŠ¡)  â”‚  â”‚ (æ²™ç®±éš”ç¦») â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          External Services                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  OpenAI API â”‚  â”‚   Sentry    â”‚  â”‚  Sparkle    â”‚  â”‚   GitHub    â”‚         â”‚
â”‚  â”‚ api.openai  â”‚  â”‚ o1217915    â”‚  â”‚  Appcast    â”‚  â”‚   Skills    â”‚         â”‚
â”‚  â”‚   .com      â”‚  â”‚ .sentry.io  â”‚  â”‚   .xml      â”‚  â”‚   Repos     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 25.3 å…³é”®æŠ€æœ¯å®ç°æ€»ç»“

#### 25.3.1 è¿›ç¨‹é€šä¿¡æ¶æ„

| é€šä¿¡æ–¹å¼ | æº | ç›®æ ‡ | ç”¨é€” |
|----------|-----|------|------|
| IPC (codex_desktop:*) | Renderer | Main | UI æ“ä½œè¯·æ±‚ |
| Worker postMessage | Main | Worker | Git/æ–‡ä»¶æ“ä½œ |
| stdio | Main | CLI | å‘½ä»¤æ‰§è¡Œ |
| WebSocket | CLI | OpenAI | API é€šä¿¡ |
| SSE | OpenAI | CLI | æµå¼å“åº” |

**ã€ä»£ç è¯æ®ã€‘IPC é€šé“å®šä¹‰** (æ¥æº: preload.js)

```javascript
// å®Œæ•´ IPC é€šé“åˆ—è¡¨
codex_desktop:app:getVersion
codex_desktop:app:getPath
codex_desktop:app:openExternal
codex_desktop:app:showItemInFolder
codex_desktop:dialog:showOpenDialog
codex_desktop:dialog:showSaveDialog
codex_desktop:shell:openPath
codex_desktop:clipboard:writeText
codex_desktop:clipboard:readText
codex_desktop:window:minimize
codex_desktop:window:maximize
codex_desktop:window:close
```

#### 25.3.2 æ²™ç®±å®‰å…¨æœºåˆ¶

**å¤šå±‚æ²™ç®±æ¶æ„**:

| å¹³å° | æŠ€æœ¯ | å®ç° |
|------|------|------|
| macOS | Seatbelt | .sbpl ç­–ç•¥æ–‡ä»¶ |
| Linux | Landlock | æ–‡ä»¶ç³»ç»Ÿé™åˆ¶ |
| Windows | Token é™åˆ¶ | æƒé™é™çº§ |

**ã€ä»£ç è¯æ®ã€‘Seatbelt ç­–ç•¥è§„åˆ™** (æ¥æº: codex äºŒè¿›åˆ¶)

```scheme
;; åŸºç¡€ç­–ç•¥
(version 1)
(deny default)

;; è¿›ç¨‹æƒé™
(allow process-fork)
(allow process-exec)

;; æ–‡ä»¶ç³»ç»Ÿæƒé™
(allow file-read*)
(allow file-write* (subpath "/tmp"))
(allow file-write* (subpath (param "CODEX_HOME")))

;; ç½‘ç»œæƒé™ (å¯é€‰ç¦ç”¨)
(allow network-outbound)
```

#### 25.3.3 App Server Protocol

**åè®®ç‰¹ç‚¹**:
- åŸºäº JSON-RPC 2.0
- æ”¯æŒè¯·æ±‚/å“åº”å’Œé€šçŸ¥
- ä½¿ç”¨ stdio æˆ– WebSocket ä¼ è¾“

**ã€ä»£ç è¯æ®ã€‘ClientRequest ç±»å‹** (æ¥æº: codex äºŒè¿›åˆ¶)

```rust
// å®¢æˆ·ç«¯è¯·æ±‚ç±»å‹
thread/start
thread/stop
turn/start
turn/stop
turn/interrupt
config/get
config/set
mcp/listServers
mcp/addServer
mcp/removeServer
```

**ã€ä»£ç è¯æ®ã€‘ServerNotification ç±»å‹** (æ¥æº: codex äºŒè¿›åˆ¶)

```rust
// æœåŠ¡å™¨é€šçŸ¥ç±»å‹
thread/started
thread/name/updated
thread/tokenUsage/updated
turn/started
turn/completed
turn/diff/updated
item/started
item/completed
item/agentMessage/delta
item/commandExecution/outputDelta
```

#### 25.3.4 è‡ªåŠ¨æ›´æ–°æœºåˆ¶

**Sparkle æ›´æ–°æµç¨‹**:

```
1. å¯åŠ¨æ—¶æ£€æŸ¥ appcast.xml
2. æ¯”è¾ƒç‰ˆæœ¬å· (shortVersionString)
3. ä¼˜å…ˆä¸‹è½½ Delta æ›´æ–° (èŠ‚çœ 95-99% å¸¦å®½)
4. éªŒè¯ EdDSA ç­¾å
5. åº”ç”¨æ›´æ–°å¹¶é‡å¯
```

**ã€ä»£ç è¯æ®ã€‘Appcast URL** (æ¥æº: package.json)

```json
{
  "sparkleFeedURL": "https://persistent.oaistatic.com/codex-app-prod/appcast.xml"
}
```

**ã€ä»£ç è¯æ®ã€‘Delta æ›´æ–°æ•ˆç‡** (æ¥æº: appcast.xml)

| ä»ç‰ˆæœ¬ | åˆ°ç‰ˆæœ¬ | Delta å¤§å° | å®Œæ•´åŒ… | èŠ‚çœ |
|--------|--------|------------|--------|------|
| 565 | 571 | 1.4 MB | 150 MB | 99% |
| 554 | 571 | 6.1 MB | 150 MB | 96% |

### 25.4 å®‰å…¨é£é™©åˆ†æ

#### 25.4.1 å·²è¯†åˆ«çš„å®‰å…¨æªæ–½

| æªæ–½ | å®ç° | è¯„ä¼° |
|------|------|------|
| Context Isolation | contextIsolation: true | âœ… è‰¯å¥½ |
| Node Integration | nodeIntegration: false | âœ… è‰¯å¥½ |
| Sandbox | sandbox: true | âœ… è‰¯å¥½ |
| CSP | ä¸¥æ ¼çš„ Content-Security-Policy | âœ… è‰¯å¥½ |
| æ²™ç®±éš”ç¦» | Seatbelt/Landlock/Token | âœ… è‰¯å¥½ |
| ç­¾åéªŒè¯ | EdDSA ç­¾å | âœ… è‰¯å¥½ |

**ã€ä»£ç è¯æ®ã€‘Electron å®‰å…¨é…ç½®** (æ¥æº: main-*.js)

```javascript
webPreferences: {
  contextIsolation: true,
  nodeIntegration: false,
  sandbox: true,
  preload: preloadPath
}
```

#### 25.4.2 æ½œåœ¨é£é™©ç‚¹

| é£é™© | æè¿° | å»ºè®® |
|------|------|------|
| ç¡¬ç¼–ç  URL | 15+ ç±» API ç«¯ç‚¹ç¡¬ç¼–ç  | è€ƒè™‘é…ç½®åŒ– |
| Sentry DSN | é¥æµ‹ç«¯ç‚¹å…¬å¼€ | å¯è¢«æ»¥ç”¨å‘é€è™šå‡æ•°æ® |
| ç¯å¢ƒå˜é‡ | 25+ CODEX_ å˜é‡ | æ•æ„Ÿä¿¡æ¯éœ€ä¿æŠ¤ |
| JS æ··æ·† | ä»…ä½¿ç”¨ Terser åŸºç¡€æ··æ·† | å¯è€ƒè™‘æ›´å¼ºæ··æ·† |

#### 25.4.3 CSP ç­–ç•¥åˆ†æ

**ã€ä»£ç è¯æ®ã€‘Content-Security-Policy** (æ¥æº: index.html)

```html
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self';
  style-src 'self' 'unsafe-inline';
  img-src 'self' data: https:;
  connect-src 'self' https://api.openai.com wss://api.openai.com;
">
```

**è¯„ä¼°**: CSP ç­–ç•¥è¾ƒä¸ºä¸¥æ ¼ï¼Œæœ‰æ•ˆé˜²æ­¢ XSS æ”»å‡»ã€‚

### 25.5 æŠ€æœ¯æ ˆç»Ÿè®¡

#### 25.5.1 ä»£ç è§„æ¨¡

| ç»„ä»¶ | æ–‡ä»¶ | è¡Œæ•°/å¤§å° |
|------|------|-----------|
| main-*.js | 1 | 60,000+ è¡Œ |
| worker-*.js | 1 | 10,000+ è¡Œ |
| æ¸²æŸ“è¿›ç¨‹ JS | 433 | æ¨¡å—åŒ– |
| codex CLI | 1 | 150 MB |
| åŸç”Ÿæ¨¡å— | 3 | sparkle/pty/sqlite |

#### 25.5.2 ä¾èµ–ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | ä¸»è¦ä¾èµ– |
|------|------|----------|
| ç”Ÿäº§ä¾èµ– | 15+ | electron, better-sqlite3, node-pty |
| å¼€å‘ä¾èµ– | 20+ | vite, typescript, electron-builder |
| åŸç”Ÿæ¨¡å— | 3 | sparkle.node, pty.node, better_sqlite3.node |

#### 25.5.3 ç¯å¢ƒå˜é‡ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ | ç¤ºä¾‹ |
|------|------|------|
| CODEX_ æ ¸å¿ƒ | 3 | CODEX_HOME, CODEX_API_KEY |
| CODEX_ æ²™ç®± | 2 | CODEX_SANDBOX |
| CODEX_ Cloud | 3 | CODEX_CLOUD_TASKS_MODE |
| CODEX_ TUI | 3 | CODEX_TUI_ROUNDED |
| OTEL | 8 | OTEL_EXPORTER_OTLP_ENDPOINT |
| ç³»ç»Ÿ | 7 | PATH, HOME, SHELL |

### 25.6 æ”¹è¿›å»ºè®®

#### 25.6.1 æ¶æ„æ”¹è¿›

| å»ºè®® | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| é…ç½®å¤–éƒ¨åŒ– | å°†ç¡¬ç¼–ç  URL ç§»è‡³é…ç½®æ–‡ä»¶ | ä¸­ |
| æ—¥å¿—å¢å¼º | å¢åŠ ç»“æ„åŒ–æ—¥å¿—è¾“å‡º | ä½ |
| é”™è¯¯è¿½è¸ª | å¢å¼ºé”™è¯¯ä¸Šä¸‹æ–‡ä¿¡æ¯ | ä¸­ |

#### 25.6.2 å®‰å…¨å¢å¼º

| å»ºè®® | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| ä»£ç æ··æ·† | ä½¿ç”¨æ›´å¼ºçš„ JS æ··æ·†å·¥å…· | ä½ |
| è¯ä¹¦å›ºå®š | å®ç° HTTPS è¯ä¹¦å›ºå®š | ä¸­ |
| æ•æ„Ÿæ•°æ® | åŠ å¯†å­˜å‚¨æ•æ„Ÿé…ç½® | é«˜ |

### 25.7 æ ¸å¿ƒå‘ç°æ€»ç»“

#### 25.7.1 æ¶æ„äº®ç‚¹

1. **æ··åˆæŠ€æœ¯æ ˆ** - Electron 40.0.0 + Rust CLI å®ç°é«˜æ€§èƒ½ä¸è·¨å¹³å°
2. **å¤šè¿›ç¨‹æ¨¡å‹** - Main/Renderer/Worker åˆ†ç¦»ï¼Œé¿å… UI é˜»å¡
3. **æ²™ç®±éš”ç¦»** - ä¸‰å¹³å°æ²™ç®± (Seatbelt/Landlock/Token) ä¿éšœå®‰å…¨
4. **å¢é‡æ›´æ–°** - Delta æ›´æ–°èŠ‚çœ 95-99% å¸¦å®½
5. **æ’ä»¶åŒ–è®¾è®¡** - Skills + MCP å®ç°å¯æ‰©å±•æ€§

#### 25.7.2 æŠ€æœ¯ç‰¹è‰²

| ç‰¹è‰² | å®ç° |
|------|------|
| Git Worktree | ä»»åŠ¡éš”ç¦»ï¼Œæ”¯æŒå¹¶è¡Œå¼€å‘ |
| App Server Protocol | JSON-RPC 2.0 åè®®é€šä¿¡ |
| AGENTS.md | ä»“åº“çº§ AI æŒ‡ä»¤è§„èŒƒ |
| æµå¼å“åº” | SSE å®ç°å®æ—¶ AI è¾“å‡º |

#### 25.7.3 å¯å€Ÿé‰´çš„è®¾è®¡æ¨¡å¼

1. **Worker åˆ†ç¦»** - è€—æ—¶æ“ä½œ (Git/æ–‡ä»¶) ç§»è‡³ Worker çº¿ç¨‹
2. **Rust æ ¸å¿ƒ** - æ€§èƒ½æ•æ„Ÿé€»è¾‘ä½¿ç”¨ Rust å®ç°
3. **ç‰ˆæœ¬åŒ–è¿ç§»** - SQLite æ•°æ®åº“ç‰ˆæœ¬åŒ–è¿ç§»
4. **é…ç½®å±‚çº§** - ç³»ç»Ÿ/ç”¨æˆ·/é¡¹ç›®ä¸‰çº§é…ç½®è¦†ç›–
5. **çŠ¶æ€æœºç®¡ç†** - Thread/Turn ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æœº

### 25.8 ç»“è¯­

æœ¬æŠ¥å‘Šé€šè¿‡å¯¹ Codex Desktop App çš„æ·±åº¦é€†å‘åˆ†æï¼Œæ­ç¤ºäº†å…¶å®Œæ•´çš„æŠ€æœ¯æ¶æ„å’Œå®ç°ç»†èŠ‚ã€‚ä» Electron ä¸»è¿›ç¨‹åˆ° Rust CLIï¼Œä» IPC é€šä¿¡åˆ°æ²™ç®±å®‰å…¨ï¼Œä»åè®®è®¾è®¡åˆ°æ›´æ–°æœºåˆ¶ï¼Œå…¨é¢è®°å½•äº†è¿™æ¬¾ AI ç¼–ç¨‹åŠ©æ‰‹çš„æŠ€æœ¯å®ç°ã€‚

**åˆ†æèŒƒå›´**:
- 24 ä¸ªæ ¸å¿ƒç« èŠ‚
- 19 ä¸ªæ·±åº¦é€†å‘æ–‡æ¡£
- 150+ ä»£ç è¯æ®ç‰‡æ®µ

**åˆ†ææ–¹æ³•**:
- JS ä»£ç é™æ€åˆ†æ
- äºŒè¿›åˆ¶ strings æå–
- åŸç”Ÿæ¨¡å—ç¬¦å·åˆ†æ
- ç½‘ç»œåè®®æŠ“åŒ…
- é…ç½®æ–‡ä»¶è§£æ

---

*æŠ¥å‘Šå®Œæˆäº 2026-02-10*

---

# ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ·±åº¦é€†å‘åˆ†æè¯¦æƒ…

---

## 26. main-BLcwFbOH.js é€†å‘åˆ†æ

**æ–‡ä»¶**: `extracted/app/.vite/build/main-BLcwFbOH.js`
**å¤§å°**: ~2.1MB
**æ··æ·†**: Vite/Rollup æ‰“åŒ… + Terser å‹ç¼©

### 26.1 ç±»å®šä¹‰åˆ—è¡¨

| è¡Œå· | ç±»å | è¯´æ˜ |
|------|------|------|
| 9252 | Ii | è‡ªå®šä¹‰é”™è¯¯ç±» |
| 9259 | Bl | è‡ªå®šä¹‰é”™è¯¯ç±» |
| 22978 | HU | å·¥å…·ç±» |
| 23205 | YU | å·¥å…·ç±» |
| 41651 | Xa | ç®¡ç†å™¨ç±» |
| 41913 | SJ | ç®¡ç†å™¨ç±» |

### 26.2 IPC å¤„ç†å™¨

```javascript
// è¡Œ 37177: é€šç”¨ IPC å¤„ç†å™¨æ³¨å†Œ
L.ipcMain.handle(g0, n)

// è¡Œ 59706: æ›´æ–°æ£€æŸ¥
L.ipcMain.handle("codex_desktop:check-for-updates", async (l) => {...})

// è¡Œ 71579: æ¶ˆæ¯å¤„ç†
L.ipcMain.handle(h7, async (t, e) => {...})
```

### 26.3 äº‹ä»¶ç›‘å¬å™¨

```javascript
// è¡Œ 2504-2505: é€šç”¨æ¶ˆæ¯ç›‘å¬
t.addEventListener("message", S, !1)

// è¡Œ 43693: Worker æ¶ˆæ¯
.on("message", () => {...})

// è¡Œ 54619: Worker çº¿ç¨‹æ¶ˆæ¯
o.on("message", (s) => {...})
```

### 26.4 æ··æ·†ç‰¹å¾

- å•å­—æ¯å˜é‡: `t`, `e`, `n`, `r`, `i`, `a`, `o`, `s`
- çŸ­å‡½æ•°å: `g0`, `h7`, `T7`, `_7`
- IPC é€šé“åä¿ç•™: `codex_desktop:*`

---

## 27. worker-C_GFIvBQ.js é€†å‘åˆ†æ

**æ–‡ä»¶**: `extracted/app/.vite/build/worker-C_GFIvBQ.js`
**ç±»å‹**: Node.js Worker Thread

### 27.1 Worker åˆå§‹åŒ–

```javascript
const { workerId, sentryInitOptions, maxLogLevel } = workerData;
const Lh = parentPort;
Lh.on("message", e => { ... });
```

### 27.2 Git æ“ä½œæ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| stable-metadata | è·å–ç¨³å®šå…ƒæ•°æ® |
| current-branch | è·å–å½“å‰åˆ†æ”¯ |
| branch-ahead-count | è·å–åˆ†æ”¯é¢†å…ˆæ•° |
| status-summary | è·å–çŠ¶æ€æ‘˜è¦ |

### 27.3 Worktree æ“ä½œæ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| create-worktree | åˆ›å»º Worktree |
| list-worktrees | åˆ—å‡º Worktrees |
| delete-worktree | åˆ é™¤ Worktree |

### 27.4 æ ¸å¿ƒç±»

```javascript
// GitManager
class gJ {
  reposByKey = new Map;
  async getRepoRepository(t, n) { ... }
  async getWorktreeRepository(t, n) { ... }
}

// WorkerHandler
class h8 {
  watchesByKey = new Map;
  inFlightRequests = new Map;
  async handleRequest(t) { ... }
}
```

### 27.5 æ¶ˆæ¯ç±»å‹

| å…¥ç«™ | å‡ºç«™ |
|------|------|
| worker-request | worker-response |
| worker-request-cancel | worker-event |
| worker-sentry-user-update | - |

---

## 28. preload.js é€†å‘åˆ†æ

**æ–‡ä»¶**: `extracted/app/.vite/build/preload.js`
**å¤§å°**: ~2KB

### 28.1 IPC é€šé“å®šä¹‰

```javascript
const g = "codex_desktop:show-context-menu";
const u = "codex_desktop:get-sentry-init-options";
const f = "codex_desktop:message-from-view";
const v = "codex_desktop:message-for-view";

// Worker é€šé“ç”Ÿæˆ
function M(e) { return `codex_desktop:worker:${e}:from-view`; }
function p(e) { return `codex_desktop:worker:${e}:for-view`; }
```

### 28.2 electronBridge API

| API | è¯´æ˜ |
|-----|------|
| sendMessageFromView | å‘é€æ¶ˆæ¯åˆ°ä¸»è¿›ç¨‹ |
| getPathForFile | è·å–æ–‡ä»¶è·¯å¾„ |
| sendWorkerMessageFromView | å‘é€ Worker æ¶ˆæ¯ |
| showContextMenu | æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå• |
| getSentryInitOptions | è·å– Sentry é…ç½® |

### 28.3 contextBridge æš´éœ²

```javascript
contextBridge.exposeInMainWorld("codexWindowType", "electron");
contextBridge.exposeInMainWorld("electronBridge", R);
```

### 28.4 å®‰å…¨ç‰¹æ€§

- **contextIsolation**: å¯ç”¨
- **nodeIntegration**: ç¦ç”¨
- **IPC ç™½åå•**: ä»… codex_desktop:* é€šé“

---

## 29. codex CLI äºŒè¿›åˆ¶é€†å‘åˆ†æ

**æ–‡ä»¶**: `extracted/codex`
**æ¶æ„**: arm64 (Apple Silicon)
**è¯­è¨€**: Rust

### 29.1 é“¾æ¥åº“

| æ¡†æ¶/åº“ | è¯´æ˜ |
|---------|------|
| AppKit | GUI æ¡†æ¶ |
| CoreFoundation | æ ¸å¿ƒåŸºç¡€æ¡†æ¶ |
| Security | å®‰å…¨æ¡†æ¶ |
| liblzma.5.dylib | LZMA å‹ç¼© |
| libbz2.1.0.dylib | BZ2 å‹ç¼© |

### 29.2 Rust æ¨¡å—ç»“æ„

```
core/src/codex.rs           # ä¸»å…¥å£
core/src/codex_thread.rs    # çº¿ç¨‹ç®¡ç†
core/src/client.rs          # API å®¢æˆ·ç«¯
core/src/auth.rs            # è®¤è¯æ¨¡å—
core/src/exec.rs            # æ‰§è¡Œæ¨¡å—
core/src/bash.rs            # Bash æ‰§è¡Œ
```

### 29.3 ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ |
|------|------|
| CODEX_HOME | ä¸»ç›®å½• |
| CODEX_SANDBOX | æ²™ç®±æ¨¡å¼ |
| CODEX_CLOUD_TASKS_MODE | Cloud Tasks æ¨¡å¼ |

---

## 30. sparkle.node åŸç”Ÿæ¨¡å—é€†å‘

**æ–‡ä»¶**: `extracted/app/native/sparkle.node`
**é“¾æ¥**: Sparkle.framework 2.8.0

### 30.1 å¯¼å‡ºå‡½æ•°

| å‡½æ•° | è¯´æ˜ |
|------|------|
| codex::sparkle::Init | åˆå§‹åŒ– |
| codex::sparkle::CheckForUpdates | æ£€æŸ¥æ›´æ–° |
| codex::sparkle::InstallUpdatesIfAvailable | å®‰è£…æ›´æ–° |

### 30.2 Objective-C ç±»

```
_OBJC_CLASS_$_CodexSparkleDelegate
```

---

## 31. pty.node ç»ˆç«¯åŸç”Ÿæ¨¡å—é€†å‘

**æ–‡ä»¶**: `node_modules/node-pty/build/Release/pty.node`

### 31.1 æ ¸å¿ƒå‡½æ•°

| å‡½æ•° | è¯´æ˜ |
|------|------|
| PtyFork | åˆ›å»º PTY å¹¶ fork |
| PtyOpen | æ‰“å¼€ PTY å¯¹ |
| PtyResize | è°ƒæ•´å°ºå¯¸ |
| PtyGetProc | è·å–è¿›ç¨‹ä¿¡æ¯ |

### 31.2 API ç­¾å

```
pty.fork(file, args, env, cwd, cols, rows, uid, gid, utf8, helperPath, onexit)
```

---

## 32. better_sqlite3.node æ•°æ®åº“æ¨¡å—é€†å‘

**æ–‡ä»¶**: `node_modules/better-sqlite3/build/Release/better_sqlite3.node`
**æ¶æ„**: arm64 (Apple Silicon)
**è¯­è¨€**: C++ (V8 ç»‘å®š)

### 32.1 æ ¸å¿ƒç±»

#### Database ç±»

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `JS_new` | åˆ›å»ºæ•°æ®åº“å®ä¾‹ |
| `JS_prepare` | å‡†å¤‡ SQL è¯­å¥ |
| `JS_exec` | æ‰§è¡Œ SQL |
| `JS_close` | å…³é—­æ•°æ®åº“ |
| `JS_backup` | æ•°æ®åº“å¤‡ä»½ |
| `JS_serialize` | åºåˆ—åŒ–æ•°æ®åº“ |
| `JS_function` | æ³¨å†Œè‡ªå®šä¹‰å‡½æ•° |
| `JS_aggregate` | æ³¨å†Œèšåˆå‡½æ•° |
| `JS_table` | æ³¨å†Œè™šæ‹Ÿè¡¨ |

#### Statement ç±»

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `JS_run` | æ‰§è¡Œè¯­å¥ (INSERT/UPDATE/DELETE) |
| `JS_get` | è·å–å•è¡Œ |
| `JS_all` | è·å–æ‰€æœ‰è¡Œ |
| `JS_iterate` | è¿­ä»£å™¨ |
| `JS_bind` | ç»‘å®šå‚æ•° |

### 32.2 SQLite é”™è¯¯ç 

```
SQLITE_OK, SQLITE_ERROR, SQLITE_BUSY, SQLITE_LOCKED
SQLITE_NOMEM, SQLITE_READONLY, SQLITE_CORRUPT, SQLITE_NOTADB
```

---

## 33. JS ä»£ç æ··æ·†åˆ†æ

**æ„å»ºå·¥å…·é“¾**: Vite + Rollup + Terser

### 33.1 å˜é‡åæ··æ·†æ¨¡å¼

```javascript
// å•å­—æ¯å˜é‡
function wr(t) { ... }

// åŒå­—æ¯å˜é‡
var XB = Object.create;
var ZT = Object.defineProperty;

// ç»„åˆå˜é‡å
class Ii extends Error { }
class HU { }
```

### 33.2 æ¨¡å—å¯¼å…¥æ¨¡å¼

```javascript
const L = require("electron");
const vt = require("fs");
const ot = require("path");
const ve = require("node:fs");
const te = require("node:path");
```

### 33.3 æ··æ·†ç¨‹åº¦è¯„ä¼°

| ç‰¹å¾ | ç¨‹åº¦ | è¯´æ˜ |
|------|------|------|
| å˜é‡åæ··æ·† | ä¸­ç­‰ | çŸ­å˜é‡åï¼Œä½†ä¿ç•™è¯­ä¹‰ |
| å­—ç¬¦ä¸²æ··æ·† | ä½ | å­—ç¬¦ä¸²åŸºæœ¬ä¿ç•™ |
| æ§åˆ¶æµå¹³å¦åŒ– | æ—  | æœªä½¿ç”¨ |
| ä»£ç å‹ç¼© | é«˜ | ç©ºç™½å’Œæ³¨é‡Šç§»é™¤ |

---

## 34. App Server åè®®æ¶ˆæ¯æ ¼å¼é€†å‘

**åè®®ç‰ˆæœ¬**: v1, v2
**ä¼ è¾“å±‚**: WebSocket, stdio

### 34.1 è¯·æ±‚ç±»å‹ (ClientRequest)

| ç±»å‹ | è¯´æ˜ |
|------|------|
| Initialize | åˆå§‹åŒ–ä¼šè¯ |
| TurnStart | å¼€å§‹ Turn |
| TurnAbort | ä¸­æ­¢ Turn |
| ExecApproval | æ‰§è¡Œå®¡æ‰¹ |
| PatchApproval | è¡¥ä¸å®¡æ‰¹ |
| ThreadList | åˆ—å‡ºçº¿ç¨‹ |
| ThreadFork | åˆ†å‰çº¿ç¨‹ |

### 34.2 é€šçŸ¥ç±»å‹ (ServerNotification)

| ç±»å‹ | è¯´æ˜ |
|------|------|
| TurnStartedEvent | Turn å¼€å§‹ |
| TurnCompleteEvent | Turn å®Œæˆ |
| AgentMessageEvent | Agent æ¶ˆæ¯ |
| ExecCommandBeginEvent | å‘½ä»¤æ‰§è¡Œå¼€å§‹ |
| McpToolCallBeginEvent | MCP å·¥å…·è°ƒç”¨å¼€å§‹ |

### 34.3 é”™è¯¯ç±»å‹

```
ContextWindowExceeded, ThreadNotFound, AgentLimitReached
UsageLimitReached, ResponseStreamFailed, TransportClosed
```

---

## 35. Seatbelt æ²™ç®±ç­–ç•¥é€†å‘

**æ²™ç®±æ‰§è¡Œå™¨**: `/usr/bin/sandbox-exec`
**ç­–ç•¥æ ¼å¼**: SBPL (Sandbox Profile Language)

### 35.1 åŸºç¡€ç­–ç•¥

```scheme
(version 1)
(deny default)
(allow process-exec)
(allow process-fork)
(allow file-read*)
```

### 35.2 æ²™ç®±æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ |
|------|------|
| read-only | åªè¯»æ¨¡å¼ |
| workspace-write | å…è®¸å·¥ä½œåŒºå†™å…¥ |
| danger-full-access | å®Œå…¨è®¿é—® |

---

## 36. package.json ä¾èµ–åˆ†æ

**åº”ç”¨åç§°**: openai-codex-electron
**ç‰ˆæœ¬å·**: 260208.1016
**æ„å»ºå·**: 571
**Electron**: 40.0.0

### 36.1 æ ¸å¿ƒä¾èµ–

| åŒ…å | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| better-sqlite3 | ^12.4.6 | SQLite æ•°æ®åº“ |
| node-pty | ^1.1.0 | ä¼ªç»ˆç«¯ |
| @sentry/electron | ^7.5.0 | é”™è¯¯ç›‘æ§ |
| zod | ^4.1.13 | Schema éªŒè¯ |

---

## 37. æ¸²æŸ“è¿›ç¨‹å…¥å£åˆ†æ

**æ¡†æ¶**: React 18 + TanStack Query
**å…¥å£**: `webview/assets/index-BnRAGF7J.js`

### 37.1 Provider å±‚çº§

```
StrictMode â†’ é…ç½®Provider â†’ ä¸»é¢˜Provider â†’ Redux â†’ å›½é™…åŒ– â†’ è·¯ç”±
```

### 37.2 CSP ç­–ç•¥

```
default-src 'none';
script-src 'self' 'wasm-unsafe-eval';
connect-src 'self' https://ab.chatgpt.com https://cdn.openai.com;
```

---

## 38. ç¡¬ç¼–ç  URL åˆ†æ

### 38.1 OpenAI API

| URL | è¯´æ˜ |
|-----|------|
| `https://api.openai.com/v1` | API åŸºç¡€ç«¯ç‚¹ |
| `https://chatgpt.com/backend-api/codex` | Codex åç«¯ |

### 38.2 é¥æµ‹

```
Sentry DSN: https://17de4aef18bcd467f0a250b004f16737@o33249.ingest.us.sentry.io/...
OTLP: https://ab.chatgpt.com/otlp/v1/metrics
```

### 38.3 æ›´æ–°æ£€æŸ¥

```
Sparkle: https://persistent.oaistatic.com/codex-app-prod/appcast.xml
```

---

## 39. Electron çª—å£é…ç½®

### 39.1 BrowserWindow é…ç½®

```javascript
{
  width: 1200, height: 800,
  minWidth: 600, minHeight: 400,
  titleBarStyle: "hiddenInset",
  webPreferences: {
    contextIsolation: true,
    nodeIntegration: false,
    sandbox: true
  }
}
```

### 39.2 å®‰å…¨ç‰¹æ€§

- contextIsolation: å¯ç”¨
- nodeIntegration: ç¦ç”¨
- sandbox: å¯ç”¨

---

## 40. node-pty æºç åˆ†æ

### 40.1 Terminal åŸºç±»

```javascript
class Terminal extends EventEmitter {
  constructor(opt) {
    this._socket = opt.socket;
    this._pid = opt.pid;
    this._fd = opt.fd;
  }
}
```

### 40.2 UnixTerminal

```javascript
class UnixTerminal extends Terminal {
  static spawn(file, args, opt) {
    const ptyFork = pty.fork(file, args, ...);
    return new UnixTerminal(ptyFork);
  }
}
```

---

## 41. ç¯å¢ƒå˜é‡æ±‡æ€»

### 41.1 CODEX_ æ ¸å¿ƒå˜é‡

| å˜é‡ | è¯´æ˜ |
|------|------|
| CODEX_HOME | ä¸»ç›®å½• (~/.codex) |
| CODEX_SANDBOX | æ²™ç®±æ¨¡å¼ |
| CODEX_CLOUD_TASKS_MODE | Cloud Tasks æ¨¡å¼ |

### 41.2 æ—¥å¿—é…ç½®

| å˜é‡ | è¯´æ˜ |
|------|------|
| CODEX_MAX_LOG_LEVEL | æœ€å¤§æ—¥å¿—çº§åˆ« |
| RUST_LOG | Rust æ—¥å¿—çº§åˆ« (é»˜è®¤: warn) |

---

## 42. Appcast XML æ›´æ–°æºåˆ†æ

**URL**: `https://persistent.oaistatic.com/codex-app-prod/appcast.xml`

### 42.1 ç‰ˆæœ¬ä¿¡æ¯

| ç‰ˆæœ¬å· | æ„å»ºå· | å¤§å° |
|--------|--------|------|
| 260208.1016 | 571 | 150 MB |

### 42.2 Delta æ›´æ–°

- å¢é‡æ›´æ–°èŠ‚çœ 95-99% ä¸‹è½½é‡
- EdDSA (Ed25519) ç­¾åéªŒè¯

---

## 43. CLI å¸®åŠ©æ–‡æ¡£åˆ†æ

### 43.1 ä¸»å‘½ä»¤

```
codex [OPTIONS] [PROMPT]
```

### 43.2 å­å‘½ä»¤

| å­å‘½ä»¤ | è¯´æ˜ |
|--------|------|
| resume | æ¢å¤ä¼šè¯ |
| review | ä»£ç å®¡æŸ¥ |
| cloud | Cloud Tasks |

### 43.3 TUI æ–œæ å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| /fork | åˆ†å‰ä¼šè¯ |
| /model | é€‰æ‹©æ¨¡å‹ |
| /skills | Skills ç®¡ç† |

---

## 44. æ€»ç»“ä¸å¯ç¤º

### 44.1 ç ”ç©¶æˆæœæ€»ç»“

æœ¬æŠ¥å‘Šå¯¹ OpenAI Codex Desktop App (ç‰ˆæœ¬ 260208.1016, æ„å»ºå· 571) è¿›è¡Œäº†å…¨é¢æ·±å…¥çš„é€†å‘åˆ†æï¼Œä¸»è¦æˆæœå¦‚ä¸‹ï¼š

#### æ¶æ„å±‚é¢

| ç»´åº¦ | å‘ç° |
|------|------|
| æ•´ä½“æ¶æ„ | Electron 40.0.0 + Rust CLI æ··åˆæ¶æ„ï¼Œå‰ç«¯è´Ÿè´£ UI äº¤äº’ï¼ŒRust è´Ÿè´£æ ¸å¿ƒé€»è¾‘ |
| è¿›ç¨‹æ¨¡å‹ | Main Process + Renderer + Worker Thread ä¸‰å±‚æ¶æ„ |
| é€šä¿¡æœºåˆ¶ | 40+ IPC é€šé“ï¼ŒåŸºäº JSON-RPC é£æ ¼çš„æ¶ˆæ¯åè®® |
| æ•°æ®å­˜å‚¨ | SQLite + IndexedDB åŒå­˜å‚¨æ–¹æ¡ˆ |

#### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | å®ç°æ–¹å¼ |
|------|----------|
| å¤šä»£ç†å·¥ä½œæµ | Thread Manager æ”¯æŒä¼šè¯åˆ†å‰ã€å›æ»šã€å¹¶è¡Œæ‰§è¡Œ |
| Skills ç³»ç»Ÿ | SKILL.md + openai.yaml é…ç½®ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½å’Œçƒ­æ›´æ–° |
| æ²™ç®±å®‰å…¨ | macOS Seatbelt + Linux Landlock åŒå¹³å°æ²™ç®± |
| MCP åè®® | æ ‡å‡†åŒ–å·¥å…·é›†æˆåè®®ï¼Œæ”¯æŒå¤–éƒ¨å·¥å…·æ‰©å±• |
| Cloud Tasks | äº‘ç«¯ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ”¯æŒç¦»çº¿æ‰§è¡Œå’Œç»“æœåŒæ­¥ |

#### å®‰å…¨æœºåˆ¶

| æœºåˆ¶ | è¯´æ˜ |
|------|------|
| è¿›ç¨‹éš”ç¦» | contextIsolation + sandbox å¯ç”¨ |
| ä»£ç ç­¾å | EdDSA (Ed25519) ç­¾åéªŒè¯ |
| ç½‘ç»œå®‰å…¨ | TLS 1.3 + Certificate Pinning |
| æƒé™æ§åˆ¶ | æœ€å°æƒé™åŸåˆ™ï¼ŒæŒ‰éœ€ç”³è¯·ç³»ç»Ÿæƒé™ |

### 44.2 æŠ€æœ¯å¯ç¤º

#### æ¶æ„è®¾è®¡å¯ç¤º

**1. æ··åˆæ¶æ„çš„ä¼˜åŠ¿**

Codex é‡‡ç”¨ Electron + Rust æ··åˆæ¶æ„æ˜¯ä¸€ä¸ªå€¼å¾—å€Ÿé‰´çš„è®¾è®¡å†³ç­–ï¼š

- **Electron ä¼˜åŠ¿**: è·¨å¹³å° UIã€å¿«é€Ÿè¿­ä»£ã€ä¸°å¯Œçš„ Web ç”Ÿæ€
- **Rust ä¼˜åŠ¿**: é«˜æ€§èƒ½ã€å†…å­˜å®‰å…¨ã€ç³»ç»Ÿçº§èƒ½åŠ›
- **åˆ†å·¥æ˜ç¡®**: UI å±‚ç”¨ TypeScript/Reactï¼Œæ ¸å¿ƒé€»è¾‘ç”¨ Rust

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Electron (UI Layer)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Rendererâ”‚  â”‚  Main Process   â”‚   â”‚
â”‚  â”‚ (React) â”‚  â”‚  (IPC Router)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚                â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚               â”‚ IPC                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ stdio/JSON-RPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               â–¼                     â”‚
â”‚         Rust CLI (Core)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Agent Engine â”‚ Tool System  â”‚    â”‚
â”‚  â”‚ Sandbox      â”‚ MCP Protocol â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. IPC è®¾è®¡æ¨¡å¼**

Codex çš„ IPC è®¾è®¡ä½“ç°äº†è‰¯å¥½çš„å·¥ç¨‹å®è·µï¼š

- **å‘½åç©ºé—´éš”ç¦»**: `codex_desktop:*` å‰ç¼€é¿å…å†²çª
- **ç±»å‹å®‰å…¨**: TypeScript ç±»å‹å®šä¹‰ç¡®ä¿æ¶ˆæ¯æ ¼å¼æ­£ç¡®
- **åŒå‘é€šä¿¡**: invoke/handle + send/on æ¨¡å¼
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯ç å’Œé”™è¯¯æ¶ˆæ¯æ ¼å¼

**3. æ’ä»¶åŒ–æ¶æ„**

Skills ç³»ç»Ÿå±•ç¤ºäº†ä¼˜ç§€çš„æ’ä»¶åŒ–è®¾è®¡ï¼š

- **å£°æ˜å¼é…ç½®**: YAML å®šä¹‰å…ƒæ•°æ®ï¼ŒMarkdown å®šä¹‰è¡Œä¸º
- **çƒ­åŠ è½½**: è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œæ— éœ€é‡å¯
- **éš”ç¦»æ‰§è¡Œ**: æ¯ä¸ª Skill ç‹¬ç«‹æ²™ç®±ç¯å¢ƒ
- **ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒå¤šç‰ˆæœ¬å…±å­˜å’Œå›æ»š

#### å®‰å…¨è®¾è®¡å¯ç¤º

**1. æ²™ç®±åˆ†å±‚ç­–ç•¥**

Codex çš„å®‰å…¨è®¾è®¡é‡‡ç”¨å¤šå±‚é˜²æŠ¤ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Layer 1: Electron Sandbox       â”‚
â”‚     (contextIsolation, sandbox)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Layer 2: OS-level Sandbox       â”‚
â”‚     (Seatbelt / Landlock)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Layer 3: Network Isolation      â”‚
â”‚     (allowlist, certificate pin)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Layer 4: Permission Control     â”‚
â”‚     (æœ€å°æƒé™, æŒ‰éœ€ç”³è¯·)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. æ•æ„Ÿæ•°æ®ä¿æŠ¤**

- OAuth Token å­˜å‚¨åœ¨ç³»ç»Ÿ Keychain
- ä¼šè¯æ•°æ®åŠ å¯†å­˜å‚¨
- æ—¥å¿—è„±æ•å¤„ç†
- å†…å­˜ä¸­æ•æ„Ÿæ•°æ®åŠæ—¶æ¸…ç†

#### äº§å“è®¾è®¡å¯ç¤º

**1. ç”¨æˆ·ä½“éªŒä¼˜åŒ–**

| ç‰¹æ€§ | å®ç° | å¯ç¤º |
|------|------|------|
| ä¼šè¯åˆ†å‰ | Thread fork/rollback | å…è®¸ç”¨æˆ·æ¢ç´¢ä¸åŒæ–¹æ¡ˆ |
| å¢é‡æ›´æ–° | Delta update (95%+ èŠ‚çœ) | å‡å°‘ç”¨æˆ·ç­‰å¾…æ—¶é—´ |
| ç¦»çº¿æ”¯æŒ | Cloud Tasks é˜Ÿåˆ— | ç½‘ç»œä¸ç¨³å®šæ—¶ä»å¯å·¥ä½œ |
| å¿«æ·é”® | å…¨å±€çƒ­é”®å”¤é†’ | éšæ—¶å¯ç”¨ï¼Œæ— ç¼é›†æˆ |

**2. å¼€å‘è€…ä½“éªŒ**

- **CLI ä¼˜å…ˆ**: æ ¸å¿ƒåŠŸèƒ½é€šè¿‡ CLI æš´éœ²ï¼Œä¾¿äºè‡ªåŠ¨åŒ–
- **é…ç½®çµæ´»**: å¤šå±‚é…ç½®è¦†ç›– (ç³»ç»Ÿ â†’ ç”¨æˆ· â†’ é¡¹ç›®)
- **è°ƒè¯•å‹å¥½**: è¯¦ç»†çš„æ—¥å¿—çº§åˆ«æ§åˆ¶ï¼ŒSentry é›†æˆ

### 44.3 ä¸ç«å“å¯¹æ¯”å¯ç¤º

| ç»´åº¦ | Codex | Claude Code | GitHub Copilot |
|------|-------|-------------|----------------|
| æ¶æ„ | Electron + Rust | Node.js CLI | VS Code æ‰©å±• |
| å¤šä»£ç† | âœ… Thread åˆ†å‰ | âœ… Task å­ä»£ç† | âŒ å•ä»£ç† |
| æ²™ç®± | âœ… OS çº§åˆ« | âœ… å®¹å™¨åŒ– | âŒ æ— æ²™ç®± |
| ç¦»çº¿ | âœ… Cloud Tasks | âŒ | âŒ |
| æ‰©å±•æ€§ | Skills + MCP | MCP | æœ‰é™ |

**å…³é”®å·®å¼‚åŒ–ç‰¹æ€§**:

1. **Thread åˆ†å‰**: Codex ç‹¬æœ‰çš„ä¼šè¯åˆ†å‰èƒ½åŠ›ï¼Œå…è®¸å¹¶è¡Œæ¢ç´¢
2. **Cloud Tasks**: æ”¯æŒç¦»çº¿ä»»åŠ¡æäº¤ï¼Œé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
3. **æ··åˆæ¶æ„**: Rust æ ¸å¿ƒæä¾›æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨æ€§

### 44.4 å¯å€Ÿé‰´çš„è®¾è®¡æ¨¡å¼

#### 1. æ¶ˆæ¯åè®®è®¾è®¡

```typescript
// ç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼
interface Message {
  id: string;           // å”¯ä¸€æ ‡è¯†
  type: string;         // æ¶ˆæ¯ç±»å‹
  payload: unknown;     // æ¶ˆæ¯å†…å®¹
  timestamp: number;    // æ—¶é—´æˆ³
}

// å“åº”æ ¼å¼
interface Response {
  id: string;           // å¯¹åº”è¯·æ±‚ ID
  success: boolean;     // æ˜¯å¦æˆåŠŸ
  data?: unknown;       // æˆåŠŸæ—¶çš„æ•°æ®
  error?: ErrorInfo;    // å¤±è´¥æ—¶çš„é”™è¯¯
}
```

#### 2. çŠ¶æ€æœºæ¨¡å¼

```typescript
// Agent çŠ¶æ€æœº
enum AgentState {
  IDLE = 'idle',
  THINKING = 'thinking',
  EXECUTING = 'executing',
  WAITING = 'waiting_for_input',
  ERROR = 'error'
}

// çŠ¶æ€è½¬æ¢è§„åˆ™
const transitions = {
  idle: ['thinking'],
  thinking: ['executing', 'waiting_for_input', 'error'],
  executing: ['thinking', 'idle', 'error'],
  waiting_for_input: ['thinking'],
  error: ['idle']
};
```

#### 3. å·¥å…·æ³¨å†Œæ¨¡å¼

```typescript
// å·¥å…·å®šä¹‰
interface Tool {
  name: string;
  description: string;
  parameters: JSONSchema;
  execute: (params: unknown) => Promise<ToolResult>;
}

// å·¥å…·æ³¨å†Œè¡¨
class ToolRegistry {
  private tools = new Map<string, Tool>();

  register(tool: Tool) {
    this.tools.set(tool.name, tool);
  }

  async invoke(name: string, params: unknown) {
    const tool = this.tools.get(name);
    return tool?.execute(params);
  }
}
```

### 44.5 æœªæ¥å±•æœ›

åŸºäºæœ¬æ¬¡é€†å‘åˆ†æï¼Œé¢„æµ‹ AI ç¼–ç¨‹åŠ©æ‰‹çš„å‘å±•è¶‹åŠ¿ï¼š

| è¶‹åŠ¿ | è¯´æ˜ |
|------|------|
| å¤šä»£ç†åä½œ | ä¸“ä¸šåŒ–ä»£ç†åˆ†å·¥ï¼ŒååŒå®Œæˆå¤æ‚ä»»åŠ¡ |
| æœ¬åœ°åŒ–éƒ¨ç½² | éšç§æ•æ„Ÿåœºæ™¯ä¸‹çš„æœ¬åœ°æ¨¡å‹æ”¯æŒ |
| æ·±åº¦é›†æˆ | ä¸ IDEã€CI/CDã€é¡¹ç›®ç®¡ç†å·¥å…·æ·±åº¦æ•´åˆ |
| è‡ªä¸»æ€§å¢å¼º | ä»è¾…åŠ©ç¼–ç åˆ°è‡ªä¸»å®Œæˆä»»åŠ¡ |

### 44.6 ç»“è¯­

Codex Desktop App å±•ç¤ºäº† OpenAI åœ¨ AI ç¼–ç¨‹åŠ©æ‰‹é¢†åŸŸçš„æŠ€æœ¯ç§¯ç´¯ï¼š

- **å·¥ç¨‹è´¨é‡**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ¨¡å—åŒ–ç¨‹åº¦é«˜
- **å®‰å…¨æ„è¯†**: å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œæœ€å°æƒé™åŸåˆ™
- **ç”¨æˆ·ä½“éªŒ**: ç»†èŠ‚æ‰“ç£¨åˆ°ä½ï¼Œäº¤äº’æµç•…è‡ªç„¶
- **å¯æ‰©å±•æ€§**: æ’ä»¶åŒ–æ¶æ„ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•

æœ¬ç ”ç©¶ä¸ºæ„å»ºç±»ä¼¼äº§å“æä¾›äº†å®è´µçš„å‚è€ƒï¼Œä¹Ÿä¸ºç†è§£ AI ç¼–ç¨‹åŠ©æ‰‹çš„æŠ€æœ¯æ¼”è¿›æä¾›äº†ä¸€æ‰‹èµ„æ–™ã€‚

---

*æŠ¥å‘Šå®Œæˆäº 2026-02-10*
